{"version":3,"sources":["webpack://gamelib/./node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack://gamelib/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://gamelib/./src/pages/KeysPage.ts"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","KeysPage","listeningEvent","state","parent","this","updateKey","bind","base","router","getData","actions","keyMap","header","document","createElement","innerText","appendChild","container","classList","add","btn","id","replace","addEventListener","setListeningEvent","append","home","href","requestTransition","event","querySelectorAll","forEach","it","remove","getElementById","removeEventListener","stopPropagation","previous","preventDefault","values","action","remapControl"],"mappings":"gGAAe,SAASA,EAAgBC,EAAUC,GAChD,KAAMD,aAAoBC,GACxB,MAAM,IAAIC,UAAU,qC,6CCFxB,SAASC,EAAkBC,EAAQC,GACjC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CACrC,IAAIE,EAAaH,EAAMC,GACvBE,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDC,OAAOC,eAAeT,EAAQI,EAAWM,IAAKN,IAInC,SAASO,EAAad,EAAae,EAAYC,GAG5D,OAFID,GAAYb,EAAkBF,EAAYiB,UAAWF,GACrDC,GAAad,EAAkBF,EAAagB,GACzChB,E,4MCRF,IAAMkB,EAAb,WAKE,cAAc,oBAJNC,oBAIM,OAHNC,WAGM,OAFNC,YAEM,EACZC,KAAKC,UAAYD,KAAKC,UAAUC,KAAKF,MANzC,mCASE,SACEG,EACAC,EACAN,GACM,WACNE,KAAKF,MAAQA,EACbE,KAAKD,OAASI,EAFR,MAGsBL,EAAMO,UAA1BC,EAHF,EAGEA,QAASC,EAHX,EAGWA,OACXC,EAASC,SAASC,cAAc,MACtCF,EAAOG,UAAY,oBACnBR,EAAKS,YAAYJ,GAEjB,IAAMK,EAAYJ,SAASC,cAAc,OACzCG,EAAUC,UAAUC,IAAI,iBATlB,Q,w5BAAA,CAWYT,GAXZ,yBAWKf,EAXL,QAYEyB,EAAMP,SAASC,cAAc,UACnCM,EAAIC,GAAK1B,EACTyB,EAAIL,UAAJ,UAAmBpB,EAAI2B,QAAQ,oBAAqB,OAApD,aACEX,EAAOhB,GADT,KAGAyB,EAAIG,iBAAiB,SAAS,WAC5B,EAAKC,kBAAkBtB,EAAOP,MAEhCsB,EAAUD,YAAYI,IATxB,2BAA2B,IAXrB,8BAuBNb,EAAKkB,OAAOR,GACZ,IAAMS,EAAOb,SAASC,cAAc,KACpCY,EAAKC,KAAO,IACZD,EAAKH,iBAAiB,SAAS,WAC7BrB,EAAMM,OAAOoB,kBAAkB,WAEjCF,EAAKX,UAAY,OACjBR,EAAKS,YAAYU,KA3CrB,kBA8CE,WACEtB,KAAKD,OAAOoB,iBAAiB,UAAWnB,KAAKC,aA/CjD,2BAmDE,WACE,OAAO,IApDX,+BAuDE,SACEH,EACA2B,GAEAhB,SACGiB,iBAAiB,UACjBC,SAAQ,SAACC,GAAD,OAAQA,EAAGd,UAAUe,OAAO,cACvC7B,KAAKH,eAAiB4B,EACtB,IAAMT,EAAMP,SAASqB,eAAeL,GACpCT,EAAIF,UAAUC,IAAI,WAClBC,EAAIL,UAAY,4BAjEpB,qBAoEE,WACEF,SAASsB,oBAAoB,UAAW/B,KAAKC,aArEjD,uBAwEE,SAAUwB,GACR,IACQlB,EADYP,KAAKF,MAAMO,UACvBE,OACR,GAAiB,UAAbkB,EAAMlC,IAER,OADAkC,EAAMO,kBACsB,KAAxBhC,KAAKH,oBACPG,KAAKF,MAAMM,OAAO6B,SAASjC,KAAKF,QAGlCW,SAASiB,iBAAiB,UAAUC,SAAQ,SAACX,GAC3CA,EAAIL,UAAJ,UAAmBK,EAAIC,GAAGC,QAAQ,oBAAqB,OAAvD,aACEX,EAAOS,EAAIC,IADb,KAGAD,EAAIF,UAAUe,OAAO,mBAEvB7B,KAAKH,eAAiB,KAGxB,GAAIG,KAAKH,gBAA0C,KAAxBG,KAAKH,eAAuB,CAErD,GADA4B,EAAMS,iBAEJT,EAAMlC,OAAOF,OAAO8C,OAAO5B,IAC3BA,EAAOP,KAAKH,kBAAoB4B,EAAMlC,IAEtC,OAEF,IAAM6C,EAASpC,KAAKH,eACpBG,KAAKF,MAAMuC,aAAaD,EAAQX,EAAMlC,KACtC,IAAMyB,EAAMP,SAASqB,eAAeM,GACpCpB,EAAIL,UAAJ,UAAmByB,EAAOlB,QAAQ,oBAAqB,OAAvD,aACEX,EAAO6B,GADT,KAGApC,KAAKH,eAAiB,GACtBmB,EAAIF,UAAUe,OAAO,gBAzG3B","file":"176.js","sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import { BasePersistedData } from \"../core/data/BasePersistedData\";\nimport { GlobalState } from \"../core/menus/GlobalState\";\nimport { Page } from \"../core/menus/Page\";\nimport { Router } from \"../core/menus/Router\";\n\nexport class KeysPage implements Page<GlobalState<BasePersistedData>> {\n  private listeningEvent: string;\n  private state: GlobalState<BasePersistedData>;\n  private parent: HTMLElement;\n\n  constructor() {\n    this.updateKey = this.updateKey.bind(this);\n  }\n\n  load(\n    base: HTMLElement,\n    router: Router<GlobalState<BasePersistedData>>,\n    state: GlobalState<BasePersistedData>\n  ): void {\n    this.state = state;\n    this.parent = base;\n    const { actions, keyMap } = state.getData();\n    const header = document.createElement(\"h1\");\n    header.innerText = \"Key Configuration\";\n    base.appendChild(header);\n\n    const container = document.createElement(\"div\");\n    container.classList.add(\"btn-container\");\n\n    for (const key of actions) {\n      const btn = document.createElement(\"button\");\n      btn.id = key;\n      btn.innerText = `${key.replace(/([a-z](?=[A-Z]))/g, \"$1 \")} (${\n        keyMap[key]\n      })`; // CamelCase -> Camel Case\n      btn.addEventListener(\"click\", () => {\n        this.setListeningEvent(state, key);\n      });\n      container.appendChild(btn);\n    }\n\n    base.append(container);\n    const home = document.createElement(\"a\");\n    home.href = \"#\";\n    home.addEventListener(\"click\", () => {\n      state.router.requestTransition(\"home\");\n    });\n    home.innerText = \"Back\";\n    base.appendChild(home);\n  }\n\n  init(): void {\n    this.parent.addEventListener(\"keydown\", this.updateKey);\n    return;\n  }\n\n  canTransition(): boolean {\n    return true;\n  }\n\n  setListeningEvent(\n    state: GlobalState<BasePersistedData>,\n    event: string\n  ): void {\n    document\n      .querySelectorAll(\"button\")\n      .forEach((it) => it.classList.remove(\"waiting\"));\n    this.listeningEvent = event;\n    const btn = document.getElementById(event);\n    btn.classList.add(\"waiting\");\n    btn.innerText = \"Waiting for keypress...\";\n  }\n\n  cleanup(): void {\n    document.removeEventListener(\"keydown\", this.updateKey);\n  }\n\n  updateKey(event: KeyboardEvent): void {\n    const persistence = this.state.getData();\n    const { keyMap } = persistence;\n    if (event.key == \"Escape\") {\n      event.stopPropagation();\n      if (this.listeningEvent === \"\") {\n        this.state.router.previous(this.state);\n        return;\n      }\n      document.querySelectorAll(\"button\").forEach((btn) => {\n        btn.innerText = `${btn.id.replace(/([a-z](?=[A-Z]))/g, \"$1 \")} (${\n          keyMap[btn.id]\n        })`; // CamelCase -> Camel Case\n        btn.classList.remove(\"waiting\");\n      });\n      this.listeningEvent = \"\";\n      return;\n    }\n    if (this.listeningEvent && this.listeningEvent !== \"\") {\n      event.preventDefault();\n      if (\n        event.key in Object.values(keyMap) &&\n        keyMap[this.listeningEvent] !== event.key\n      ) {\n        return;\n      }\n      const action = this.listeningEvent;\n      this.state.remapControl(action, event.key);\n      const btn = document.getElementById(action);\n      btn.innerText = `${action.replace(/([a-z](?=[A-Z]))/g, \"$1 \")} (${\n        keyMap[action]\n      })`; // CamelCase -> Camel Case\n      this.listeningEvent = \"\";\n      btn.classList.remove(\"waiting\");\n    }\n  }\n}\n"],"sourceRoot":""}