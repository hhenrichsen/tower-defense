(self.webpackChunkgamelib=self.webpackChunkgamelib||[]).push([[440],{440:(t,e,n)=>{"use strict";n.r(e),n.d(e,{GameModel:()=>Dn});var r=n(156),i=n(610),o=n(991),a=n(349),s=n(255),u=n(70),c=n(608),l=n(486),f=function(){function t(){(0,i.Z)(this,t)}return(0,o.Z)(t,[{key:"defaultData",value:function(){return{}}},{key:"init",value:function(t){return Object.assign(this.defaultData(),t||{})}}]),t}(),h=n(484),d=function(){function t(e,n){(0,i.Z)(this,t),this._x=0,this._y=0,this._x=e,this._y=n}return(0,o.Z)(t,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"squareMagnitude",value:function(){return Math.pow(this.x,2)+Math.pow(this.y,2)}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"normalize",value:function(){var e=this.magnitude();return 0==e?t.ZERO:new t(this.x/e,this.y/e)}},{key:"piecewiseScale",value:function(e){return new t(this.x*e.x,this.y*e.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"addConstant",value:function(e,n){return new t(this.x+e,this.y+n)}},{key:"floor",value:function(){return new t(Math.floor(this.x),Math.floor(this.y))}},{key:"ceil",value:function(){return new t(Math.ceil(this.x),Math.ceil(this.y))}},{key:"addScaled",value:function(e,n){return new t(this.x+e.x*n,this.y+e.y*n)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"subtractScaled",value:function(e,n){return new t(this.x-e.x*n,this.y-e.y*n)}},{key:"rotate",value:function(e){var n=e*Math.PI/180;return new t(this.x*Math.cos(n)-Math.sin(n)*this.y,this.x*Math.sin(n)+this.y*Math.cos(n))}},{key:"toAngle",value:function(){return Math.atan2(this.y,this.x)*(180/Math.PI)}},{key:"determinant",value:function(t){return this.x*t.y-this.y*t.x}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y)}},{key:"equals",value:function(t){return void 0!==t&&"object"===(0,h.Z)(t)&&Object.prototype.hasOwnProperty.call(t,"_x")&&Object.prototype.hasOwnProperty.call(t,"_y")&&t.x===this.x&&t.y===this.y}},{key:"hashCode",value:function(){return 31*this.x+this.y}}],[{key:"random",value:function(){return new t(Math.random(),Math.random()).normalize()}},{key:"fromAngle",value:function(e,n){return new t(Math.cos(e*(Math.PI/180))*(n||1),Math.sin(e*(Math.PI/180))*(n||1))}},{key:"matching",value:function(e){return new t(e,e)}},{key:"distance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}},{key:"squareDistance",value:function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}}]),t}();d.ZERO=new d(0,0),d.ONES=new d(1,1);const p=d;var v=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{position:p.ZERO}}}]),a}(f));var y=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{rotation:0}}}]),a}(f)),m=n(329),g=function(){function t(e){(0,i.Z)(this,t),this._name=void 0,this.handlers=[],this._name=e}return(0,o.Z)(t,[{key:"addHandler",value:function(t){this.handlers.push(t)}},{key:"invoke",value:function(t){for(var e=0;e<this.handlers.length;e++)this.handlers[e](this,t)}},{key:"name",get:function(){return this._name}}]),t}(),w=function(){function t(){(0,i.Z)(this,t),this.actions=void 0,this.serializeActions=void 0,this.actions=new Map,this.serializeActions=[]}return(0,o.Z)(t,[{key:"createAction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new g(t);this.actions.set(t,n),e&&this.serializeActions.push(t)}},{key:"addHandler",value:function(t,e){this.actions.has(t)?this.actions.get(t).addHandler(e):console.warn("Trying to add a handler on a nonexistent action.")}},{key:"invoke",value:function(t,e){this.actions.has(t)&&this.actions.get(t).invoke(e)}},{key:"serialize",value:function(){return(0,m.Z)(this.serializeActions)}},{key:"asImmutable",value:function(){return this}}]),t}();var Z,k=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{range:1}}}]),a}(f));function R(t){return function(e){(0,s.Z)(f,e);var n,r,a=(n=f,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,u.Z)(this,t)});function f(){return(0,i.Z)(this,f),a.apply(this,arguments)}return(0,o.Z)(f,[{key:"getName",value:function(){return(0,l.lowerFirst)(t.name)}}]),f}(t)}const C=new(R(Z=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return o}(f))||Z);var x=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{range:1,strokeStyle:"#ff0000ff",fillStyle:"#ffffff00",lineWidth:0,offset:p.ZERO}}}]),a}(f)),S=function t(e,n){(0,i.Z)(this,t),this.id=void 0,this.data=void 0,this.active=!0,this.id=e,this.data=n||{}};function E(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var O=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;(0,i.Z)(this,t),this.nextId=0,this.entities=void 0,this.entityComponents=void 0,this.systems=void 0,this.interestedSystems=void 0,this.allSystems=void 0,this.systemOrder=void 0,this.availableIDs=void 0,this.events=void 0,this.listeners=void 0,this.entities=new Map,this.systems=new Map,this.entityComponents=new Map,this.allSystems=new Set,this.systemOrder=[],this.update=this.update.bind(this),this.getEntityIDsWithComponent=this.getEntityIDsWithComponent.bind(this),this.getEntitiesWithComponent=this.getEntitiesWithComponent.bind(this),this.interestedSystems=new Map,this.availableIDs=[],this.events=[],this.listeners=new Map;for(var n=0;n<e;n++)this.createEntity({},!1),this.removeEntity(n)}return(0,o.Z)(t,[{key:"createEntity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.availableIDs.length>0&&e){var n=this.availableIDs.splice(0,1)[0],r=this.entities.get(n);return r.data=t||{},r.active=!0,this.emitEvent("ecs:create",r),n}var i=this.nextId++,o=new S(i,t);return this.entities.set(i,o),this.emitEvent("ecs:create",o),i}},{key:"listenEvent",value:function(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}},{key:"emitEvent",value:function(t,e,n){this.events.push({event:t,entity:e,extra:n})}},{key:"resolveId",value:function(t){return"number"==typeof t||"bigint"==typeof t?t>=this.nextId||!this.entities.has(t)?(console.warn("Cannot resolve entity ".concat(t,"; it does not exist.")),-1):t:t.id}},{key:"resolveEntity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("number"==typeof t||"bigint"==typeof t){var n=t;if(n>=this.nextId||!this.entities.has(n))return e||console.warn("Cannot resolve entity ".concat(t,"; it does not exist.")),null;var r=this.entities.get(t);return r.active?r:(e||console.warn("Cannot resolve entity ".concat(t,"; it has been deleted.")),null)}return t}},{key:"createSystem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.systems.has(e)||(this.systems.set(e,new Set),this.systemOrder.push(e),this.systemOrder.sort()),this.systems.get(e).add(t),this.allSystems.add(t);var n=t.getBasisComponent();null!==n&&(this.interestedSystems.has(n.getName())||this.interestedSystems.set(n.getName(),new Set),this.interestedSystems.get(n.getName()).add(t)),t.setManager(this)}},{key:"removeSystem",value:function(t){this.allSystems.delete(t),this.systems.forEach((function(e){e.has(t)&&e.delete(t)}))}},{key:"hasComponent",value:function(t,e){var n=this.resolveEntity(t);return null!=n&&e.getName()in n.data}},{key:"addComponent",value:function(t,e,n){var r=this.resolveEntity(t);if(null!==r){if(r.data[e.getName()]=e.init(n),void 0!==this.interestedSystems.get(e.getName())){var i,o=E(this.interestedSystems.get(e.getName()));try{for(o.s();!(i=o.n()).done;)i.value.notify(e.getName(),r)}catch(t){o.e(t)}finally{o.f()}}this.emitEvent("ecs:addComponent",r,{component:e}),this.entityComponents.has(e.getName())||this.entityComponents.set(e.getName(),new Set),this.entityComponents.get(e.getName()).add(r.id)}}},{key:"getEntity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.resolveEntity(t,e)}},{key:"getEntityIDsWithComponent",value:function(t){var e=t.getName();if(this.entityComponents.has(e)){var n,r=[],i=E(this.entityComponents.get(e));try{for(i.s();!(n=i.n()).done;){var o=n.value,a=this.resolveEntity(o,!0);null!==a&&a.active&&r.push(o)}}catch(t){i.e(t)}finally{i.f()}return r}return[]}},{key:"getEntitiesWithComponent",value:function(t){var e=t.getName();if(this.entityComponents.has(e)){var n,r=[],i=E(this.entityComponents.get(e));try{for(i.s();!(n=i.n()).done;){var o=n.value,a=this.resolveEntity(o,!0);null!==a&&a.active&&void 0!==a.data[e]&&r.push(a)}}catch(t){i.e(t)}finally{i.f()}return r}return[]}},{key:"removeComponent",value:function(t,e){var n=this.resolveEntity(t);if(null!==n&&(e.getName()in n.data&&delete n.data[e.getName()],this.entityComponents.has(e.getName())||this.entityComponents.set(e.getName(),new Set),this.emitEvent("ecs:removeComponent",n,{component:e}),this.entityComponents.get(e.getName()).delete(n.id),this.interestedSystems.has(e.getName()))){var r,i=E(this.interestedSystems.get(e.getName()));try{for(i.s();!(r=i.n()).done;)r.value.notify("__delete",this.entities.get(n.id))}catch(t){i.e(t)}finally{i.f()}}}},{key:"update",value:function(t,e){for(var n=0;n<this.events.length;n++){var r=this.events[n].event;if(this.listeners.has(r))for(var i=this.listeners.get(r),o=0;o<i.length;o++)i[o](this.events[n])}this.events.length=0;for(var a=0;a<this.systemOrder.length;a++){var s,u=this.systemOrder[a],c=E(this.systems.get(u));try{for(c.s();!(s=c.n()).done;)s.value.update(t,e)}catch(t){c.e(t)}finally{c.f()}}}},{key:"removeEntity",value:function(t){var e=this.resolveEntity(t);if(null!==e){var n,r=E(this.allSystems);try{for(r.s();!(n=r.n()).done;)n.value.notify("__delete",this.entities.get(e.id))}catch(t){r.e(t)}finally{r.f()}this.emitEvent("ecs:delete",e),e.data={},e.active=!1,this.availableIDs.push(e.id)}}},{key:"clear",value:function(){var t,e=E(this.allSystems);try{for(e.s();!(t=e.n()).done;)t.value.notify("__clear",null)}catch(t){e.e(t)}finally{e.f()}var n,r=E(this.entities.keys());try{for(r.s();!(n=r.n()).done;){var i=n.value;this.entities.delete(i)}}catch(t){r.e(t)}finally{r.f()}this.availableIDs=[],this.nextId=0}}]),t}();new O;var B=function(){function t(){(0,i.Z)(this,t),this.listeners=[],this.events=[],this.keyListeners=new Map,this.keyPushed=new Map,this.keyDown=this.keyDown.bind(this),this.keyUp=this.keyUp.bind(this)}return(0,o.Z)(t,[{key:"install",value:function(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp)}},{key:"keyDown",value:function(t){this.events.push({key:t.key,down:!0})}},{key:"keyUp",value:function(t){this.events.push({key:t.key,down:!1})}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"addKeyListener",value:function(t,e){this.keyListeners.has(t.toLowerCase())||this.keyListeners.set(t.toLowerCase(),[]),this.keyListeners.get(t.toLowerCase()).push(e)}},{key:"update",value:function(){for(var t=0;t<this.events.length;t++){var e=this.events[t],n=e.key.toLowerCase();if(this.keyPushed.get(n)!==e.down){if(this.keyPushed.set(n,e.down),this.keyListeners.has(n))for(var r=this.keyListeners.get(n),i=0;i<r.length;i++)r[i](e);for(var o=0;o<this.listeners.length;o++)this.listeners[o](e)}}this.events.length=0}},{key:"uninstall",value:function(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp)}}]),t}(),M=function t(){(0,i.Z)(this,t),this.isLeftMouseDown=!1,this.isRightMouseDown=!1,this.mouseCoordinate=p.ZERO},T=function(){function t(){(0,i.Z)(this,t),this.mouse=new M,this.listeners=[],this.events=[],this.getMousePosition=this.getMousePosition.bind(this)}return(0,o.Z)(t,[{key:"install",value:function(t,e){var n=this;t.addEventListener("mousemove",(function(t){var r=e.getCoordinates(),i=e.getOffset();n.mouse.mouseCoordinate=r.inverseTranslate(new p(t.x,t.y).subtract(i))})),t.addEventListener("mousedown",(function(t){n.mouse.isLeftMouseDown=!0,n.events.push({coordinate:n.mouse.mouseCoordinate,leftDown:!0})})),t.addEventListener("mouseup",(function(t){n.mouse.isLeftMouseDown=!1,n.events.push({coordinate:n.mouse.mouseCoordinate,leftDown:!1})}))}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"update",value:function(){for(var t=0;t<this.events.length;t++)for(var e=this.events[t],n=0;n<this.listeners.length;n++)this.listeners[n](e);this.events.length=0}},{key:"getMousePosition",value:function(){return this.mouse.mouseCoordinate}}]),t}(),P=function(){function t(e,n){(0,i.Z)(this,t),this.scaleX=void 0,this.scaleY=void 0,this.scaleX=e,this.scaleY=n,this.translate=this.translate.bind(this),this.translateValueX=this.translateValueX.bind(this),this.translateValueY=this.translateValueY.bind(this)}return(0,o.Z)(t,[{key:"translate",value:function(t){return new p(t.x*this.scaleX,t.y*this.scaleY)}},{key:"inverseTranslate",value:function(t){return new p(t.x/this.scaleX,t.y/this.scaleY)}},{key:"translateValueX",value:function(t){return t*this.scaleX}},{key:"translateValueY",value:function(t){return t*this.scaleY}}]),t}(),D=function(){function t(e){(0,i.Z)(this,t),this.canvas=void 0,this.context=void 0,this.virtualSize=void 0,this.aspectRatio=void 0,this.offset=p.matching(.5),this.vcs=void 0,this.installed=!1,this.parent=void 0,this.virtualSize=e,this.aspectRatio=e.normalize()}return(0,o.Z)(t,[{key:"install",value:function(t){var e=document.createElement("canvas");this.canvas=e,this.initCanvas(),t.appendChild(e),this.parent=t,this.installed=!0,this.resize()}},{key:"initCanvas",value:function(){var t=this.canvas;this.context=this.canvas.getContext("2d"),t.width=this.virtualSize.x,t.height=this.virtualSize.y,t.id="canvas",window.addEventListener("resize",this.resize.bind(this))}},{key:"drawGrid",value:function(){for(var t=0;t<this.virtualSize.x;t++)this.line(new p(t,0),new p(t,this.virtualSize.y),"#000000ff");for(var e=0;e<this.virtualSize.y;e++)this.line(new p(0,e),new p(this.virtualSize.x,e),"#000000ff")}},{key:"findCanvas",value:function(){var t=document.getElementById("canvas");"canvas"!==t.nodeName.toLowerCase()?console.error("Cannot find valid canvas, found ".concat(t.nodeName," instead.")):(this.canvas=t,this.initCanvas())}},{key:"uninstall",value:function(){this.installed=!1,this.parent.removeEventListener("resize",this.resize)}},{key:"drawWorldText",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Montserrat",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"center",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500,s=t.trim().split("\n");this.context.fillStyle=n||"#ffffff",this.context.font="".concat(a," ").concat(r*this.vcs.translateValueY(.5),"px ").concat(i),this.context.textAlign=o;for(var u=0;u<s.length;u++){var c=this.vcs.translate(e.addConstant(.5,u+.5));this.context.fillText(s[u],c.x,c.y)}}},{key:"drawText",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Montserrat",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"center",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500,s=t.trim().split("\n");this.context.fillStyle=n||"#ffffff",this.context.font="".concat(a," ").concat(r*this.vcs.translateValueY(.5),"px ").concat(i),this.context.textAlign=o;for(var u=0;u<s.length;u++){var c=this.vcs.translate(e.addConstant(0,u));this.context.fillText(s[u],c.x,c.y)}}},{key:"drawImage",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(t&&t.ready){this.context.globalAlpha=i;var o=this.vcs.translate(e.add(this.offset)),a=this.vcs.translate(n);this.context.save(),this.context.translate(o.x,o.y),this.context.rotate(r*Math.PI/180),this.context.translate(-o.x,-o.y),this.context.drawImage(t.texture,o.x-a.x/2,o.y-a.y/2,a.x,a.y),this.context.restore(),this.context.globalAlpha=1}}},{key:"drawCircle",value:function(t,e,n,r,i){var o=this.vcs.translate(t.add(this.offset)),a=this.vcs.translateValueX(e);this.context.fillStyle=n||"#ffffff00",this.context.beginPath(),this.context.arc(o.x,o.y,a,0,2*Math.PI),this.context.fill(),this.context.strokeStyle=r||"#ff0000",this.context.lineWidth=this.vcs.translateValueX(i)||1,this.context.arc(o.x,o.y,a,0,2*Math.PI),this.context.stroke()}},{key:"drawImageAnimated",value:function(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(t.ready){this.context.globalAlpha=a;var s=this.vcs.translate(e.add(this.offset)),u=this.vcs.translate(r);this.context.save(),this.context.translate(s.x,s.y),this.context.rotate(n*Math.PI/180),this.context.translate(-s.x,-s.y),this.context.drawImage(t.texture,i.x*o,0,i.x,i.y,s.x-u.x/2,s.y-u.y/2,u.x,u.y),this.context.restore(),this.context.globalAlpha=1}}},{key:"drawWorldRectangle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff00",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff00",i=this.vcs.translate(t.addConstant(.5,.5)),o=this.vcs.translate(e.addConstant(.5,.5));this.context.fillStyle=n||"#ff0000",this.context.fillRect(i.x,i.y,o.x-i.x,o.y-i.y),this.context.strokeStyle=r||"#ff0000",this.context.strokeRect(i.x,i.y,o.x-i.x,o.y-i.y)}},{key:"drawRectangle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff00",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff00",i=this.vcs.translate(t),o=this.vcs.translate(e);this.context.fillStyle=n||"#ff0000",this.context.fillRect(i.x,i.y,o.x-i.x,o.y-i.y),this.context.strokeStyle=r||"#ff0000",this.context.strokeRect(i.x,i.y,o.x-i.x,o.y-i.y)}},{key:"line",value:function(t,e,n){var r=this.vcs.translate(t),i=this.vcs.translate(e);this.beginPath(),this.strokeStyle=n||"#ff0000",this.context.lineTo(r.x,r.y),this.context.lineTo(i.x,i.y),this.stroke()}},{key:"beginPath",value:function(){this.context.beginPath()}},{key:"strokeStyle",set:function(t){this.context.strokeStyle=t}},{key:"stroke",value:function(){this.context.stroke()}},{key:"translate",value:function(t){var e=this.vcs.translate(t);this.context.translate(e.x,e.y)}},{key:"clear",value:function(){this.context.clearRect(0,0,this.vcs.translateValueX(this.virtualSize.x),this.vcs.translateValueY(this.virtualSize.y))}},{key:"getCoordinates",value:function(){return this.vcs}},{key:"getOffset",value:function(){var t=this.canvas.getBoundingClientRect();return new p(t.x,t.y)}},{key:"resize",value:function(){this.parent.clientWidth/this.aspectRatio.x<this.parent.clientHeight/this.aspectRatio.y?(this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientWidth*this.aspectRatio.y/this.aspectRatio.x):(this.canvas.width=this.parent.clientHeight*this.aspectRatio.x/this.aspectRatio.y,this.canvas.height=this.parent.clientHeight),this.vcs=new P(this.canvas.width/this.virtualSize.x,this.canvas.height/this.virtualSize.y)}}]),t}();var N=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{action:function(){}}}}]),a}(f));var A=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{delta:p.ZERO,offset:p.ZERO,thisClick:!1}}}]),a}(f));function j(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var F=function(){function t(){(0,i.Z)(this,t),this.entities=new Map,this.manager=void 0}return(0,o.Z)(t,[{key:"checkInterval",value:function(t,e){return!(t<0||e.rate<=0||e.elapsed<0||(e.elapsed+=t,!(e.elapsed>=e.rate)||(e.elapsed-=e.rate,0)))}},{key:"notify",value:function(t,e,n){if("__clear"===t)this.entities.clear();else if("__delete"===t)this.entities.delete(e.id);else if("__remove_component"===t){var r=n.componentName;this.getBasisComponent().getName()===r&&this.entities.delete(e.id)}else this.checkBasis(t,e)&&this.isInterested(t,e)&&this.entities.set(e.id,e)}},{key:"onManagerAwake",value:function(){}},{key:"setManager",value:function(t){this.manager=t,this.onManagerAwake()}},{key:"checkBasis",value:function(t,e){var n=this.getRequiredComponents(),r=this.getExcludedComponents();return this.checkRequired(t,e,n)&&this.checkExcluded(t,e,r)}},{key:"checkRequired",value:function(t,e,n){var r,i=j(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(!(o.getName()in e.data))return console.warn("Could not find required component ".concat(o.getName()," while adding ").concat(t,"; this is a required component and ").concat(t," will not trigger related systems' interest.")),!1}}catch(t){i.e(t)}finally{i.f()}return!0}},{key:"checkExcluded",value:function(t,e,n){var r,i=j(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.getName()in e.data)return console.warn("Found excluded component ".concat(o.getName()," while adding ").concat(t,"; this is an excluded component and ").concat(t," will not trigger related systems' interest.")),!1}}catch(t){i.e(t)}finally{i.f()}return!0}},{key:"update",value:function(t,e){this.systemUpdate(t,e);var n,r=j(this.entities.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;this.updateEntity(t,i,e)}}catch(t){r.e(t)}finally{r.f()}}},{key:"systemUpdate",value:function(t,e){}},{key:"listener",value:function(t){var e=t.event,n=t.entity,r=t.extra;this.entities.has(n.id)&&this.onEvent(e,n,r)}},{key:"listenerNoCheck",value:function(t){var e=t.event,n=t.entity,r=t.extra;this.onEvent(e,n,r)}},{key:"listen",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.manager.listenEvent(t,this.listener.bind(this)):this.manager.listenEvent(t,this.listenerNoCheck.bind(this))}},{key:"onEvent",value:function(t,e,n){}},{key:"getBasisComponent",value:function(){return null}},{key:"getRequiredComponents",value:function(){return new Set}},{key:"getExcludedComponents",value:function(){return new Set}},{key:"isInterested",value:function(t,e){return!0}},{key:"updateEntity",value:function(t,e,n){}}]),t}();var I=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){e.data.abstractClick.action(e,this.manager)}},{key:"getBasisComponent",value:function(){return N}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(A),t}}]),a}(F);var _=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{acceleration:p.ZERO}}}]),a}(f));function W(t){return"function"==typeof t?t():t}var L=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{velocity:p.ZERO}}}]),a}(f));var U=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.velocity,i=n.acceleration;r.velocity=W(r.velocity).addScaled(W(i.acceleration),t)}},{key:"getBasisComponent",value:function(){return _}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(L),t}}]),a}(F),q=function(){function t(e,n){var r=this;(0,i.Z)(this,t),this.size=void 0,this.el=void 0,this.ready=!1,this.el=new Image,this.el.src=e,this.el.addEventListener("load",(function(t){r.ready=!0,n||(r.size=new p(r.el.naturalWidth,r.el.naturalHeight))}))}return(0,o.Z)(t,[{key:"texture",get:function(){return this.el}}]),t}();var H=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{size:d.ONES,frameSize:d.matching(32),source:a.NoTex,frames:[1,1],frame:0,currentDuration:0,opacity:1}}}]),a}(f);H.NoTex=new q("assets/notex-anim.png",new d(64,32));const G=new H;var X=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.animatedSprite,i=n.rotation,o=n.position;for(r.currentDuration+=t;r.currentDuration>r.frames[r.frame];)r.currentDuration-=r.frames[r.frame],r.frame=(r.frame+1)%r.frames.length;this.virtualCanvas.drawImageAnimated(r.source,W(o.position),W(i.rotation),r.size,r.frameSize,r.frame,W(r.opacity))}},{key:"getBasisComponent",value:function(){return G}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(y),t}}]),a}(F);var V=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{background:"#77777755",backgroundHover:"#aaaaaa55"}}}]),a}(f));var Y=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t,e){var n;return(0,i.Z)(this,a),(n=r.call(this)).mouse=void 0,n.virtualCanvas=void 0,n.mouse=t,n.virtualCanvas=e,n}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=W(this.mouse),r=e.data,i=r.position,o=r.clickable,a=r.clickableDisplay,s=W(o.delta),u=W(i.position),c=u.subtract(s),l=u.add(s);n.x>c.x&&n.y>c.y&&n.x<l.x&&(n.y,l.y),this.virtualCanvas.drawRectangle(c,l,W(a.backgroundHover))}},{key:"getBasisComponent",value:function(){return V}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F),$=n(699);function K(t,e){return J(t.center,t.radius,e)}function J(t,e,n){return p.distance(t,n)<=e}function Q(t,e,n,r){return t.x<=r.x&&e.x>=n.x&&t.y<=r.y&&e.x>=n.y}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var et=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).mouse=void 0,e.runCheck=void 0,e.mouse=t,e.runCheck=!1,e}return(0,o.Z)(a,[{key:"update",value:function(t,e){if("click"===e.getMouseAction()){var n,r=this.entities,i=void 0,o=void 0,a=void 0,s=W(this.mouse),u=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r.values());try{for(u.s();!(n=u.n()).done;){var c=n.value,l=c.data,f=l.position,h=l.clickable,d=s.add(W(h.offset)),p=this.offsetDelta(W(f.position),W(h.delta)),v=(0,$.Z)(p,2),y=v[0],m=v[1];g=y,w=m,(Z=d).x>=g.x&&Z.x<=w.x&&Z.y>=g.y&&Z.y<=w.y&&(void 0!==i?Q(y,m,o,a)&&c.id>i.id&&(i=c):(i=c,o=y,a=m))}}catch(t){u.e(t)}finally{u.f()}void 0!==i&&this.manager.emitEvent("click",i)}var g,w,Z}},{key:"updateEntity",value:function(){}},{key:"offsetDelta",value:function(t,e){return[t.subtract(e),t.add(e)]}},{key:"getBasisComponent",value:function(){return A}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var nt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{component:C,data:{}}}}]),a}(f));var rt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){var n=e.data.clickComponentAdd;this.manager.addComponent(e.id,W(n.component),W(n.data))}},{key:"getBasisComponent",value:function(){return nt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var it=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{components:[],data:[]}}}]),a}(f));var ot=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){for(var n=e,r=n.data.clickComponentToggleMultiple,i=W(r.components),o=W(r.data),a=0;a<i.length;a++){var s=i[a];this.manager.hasComponent(n.id,s)?this.manager.removeComponent(n.id,s):this.manager.addComponent(n.id,s,o[a])}}},{key:"getBasisComponent",value:function(){return it}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(A),t}}]),a}(F);var at=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{component:C,data:{}}}}]),a}(f));var st=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){var n=e,r=n.data.clickComponentToggle,i=W(r.component);this.manager.hasComponent(n.id,i)?this.manager.removeComponent(n.id,i):this.manager.addComponent(n.id,i,W(r.data))}},{key:"getBasisComponent",value:function(){return at}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(A),t}}]),a}(F);var ut=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{data:{}}}}]),a}(f));var ct=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){var n=e,r=n.data.clickDataMutate;n.data=(0,l.merge)(n.data,W(r.data))}},{key:"getBasisComponent",value:function(){return ut}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(A),t}}]),a}(F);var lt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{dragging:!1,offset:p.ZERO}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),a}(f));var ft=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).source=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.draggable,i=n.position;r.dragging&&(i.position=this.source().add(W(r.offset)))}},{key:"getBasisComponent",value:function(){return lt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var ht,dt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{size:1,tracked:!1}}}]),a}(f)),pt=function(t){return function(e){e.prototype.getBasisComponent=function(){return t}}},vt=function(t){return function(e){for(var n=new Set,r=0;r<t.length;r++)n.add(t[r]);e.prototype.getRequiredComponents=function(){return n}}};var yt,mt=pt(dt)(ht=vt([v])(ht=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).map=void 0,e.map=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.footprint;if(!i.tracked){i.tracked=!0;for(var o=W(r.position).floor(),a=Math.floor((i.size-1)/2),s=new p(o.x-a,o.y-a),u=Math.floor(i.size/2),c=new p(o.x+u,o.y+u),l=s.x;l<=c.x;l++)for(var f=s.y;f<=c.y;f++)this.map.createEntityLink(new p(l,f),e)}}}]),a}(F))||ht)||ht;var gt=new(R(yt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return o}(f))||yt);const wt=gt;var Zt,kt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{health:10,maxHealth:10}}}]),a}(f));var Rt,Ct=pt(gt)(Zt=vt([v,kt])(Zt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.health,o=W(r.position),a=o.addConstant(-.5,-.5),s=o.addConstant(.5,-.4),u=i.health/i.maxHealth,c=o.addConstant(u-.5,-.4);this.virtualCanvas.drawWorldRectangle(a,s,"#ff000099","#00000099"),this.virtualCanvas.drawWorldRectangle(a,c,"#00ff0099","#00000099")}}]),a}(F))||Zt)||Zt;function xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var St=pt(kt)(Rt=function(t){(0,s.Z)(l,t);var e,n,a=(e=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function l(){return(0,i.Z)(this,l),a.apply(this,arguments)}return(0,o.Z)(l,[{key:"updateEntity",value:function(t,e){var n=e;n.data.health.health<=0&&(this.manager.emitEvent("health:die",n,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xt(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n.data)),this.manager.removeEntity(n))}}]),l}(F))||Rt;var Et=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{lifetime:1,elapsed:0}}}]),a}(f));const bt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),a}(f));var Ot,Bt,Mt;const Tt=new(R((Mt=Bt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;return(0,i.Z)(this,a),t=r.call(this),void 0===a.NO_TEXTURE&&(a.NO_TEXTURE=new q("assets/notex.png",p.matching(32))),t}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{source:a.NO_TEXTURE,size:a.DEFAULT_SIZE,opacity:1,offset:p.ZERO,rotationOffset:0}}}]),a}(f),Bt.NO_TEXTURE=void 0,Bt.DEFAULT_SIZE=p.ONES,Ot=Mt))||Ot);var Pt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.lifetime;n.sprite.opacity=(r.lifetime-r.elapsed)/r.lifetime}},{key:"getBasisComponent",value:function(){return bt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(Tt),t.add(Et),t}}]),a}(F);var Dt,Nt,At,jt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data.lifetime;n.elapsed+=t,n.elapsed>=n.lifetime&&this.manager.removeEntity(e.id)}},{key:"getBasisComponent",value:function(){return Et}}]),a}(F);const zt=new(R((At=Nt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;return(0,i.Z)(this,a),t=r.call(this),void 0===a.NO_TEXTURE&&(a.NO_TEXTURE=new q("assets/notex.png",p.matching(32))),t}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{source:a.NO_TEXTURE,size:a.DEFAULT_SIZE,offset:p.ZERO}}}]),a}(f),Nt.NO_TEXTURE=void 0,Nt.DEFAULT_SIZE=p.ONES,Dt=At))||Dt);var Ft;var It=pt(zt)(Ft=vt([v,y])(Ft=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.lowSprite,i=n.position;this.virtualCanvas.drawImage(r.source,W(i.position).add(W(r.offset)),r.size)}}]),a}(F))||Ft)||Ft;var _t=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{radius:1,onSnap:function(){}}}}]),a}(f));const Wt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),a}(f));var Lt=function(){function t(e,n){(0,i.Z)(this,t),this._center=void 0,this._radius=void 0,this._center=e,this._radius=n}return(0,o.Z)(t,[{key:"center",get:function(){return this._center}},{key:"radius",get:function(){return this._radius}}]),t}();var Ut=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){for(var n=e,r=n.data,i=r.magnet,o=r.position,a=new Lt(W(o.position),W(i.radius)),s=this.manager.getEntitiesWithComponent(Wt),u=0;u<s.length;u++){var c=s[u];K(a,W(c.data.position.position))&&(c.data.position.position=n.data.position.position,i.onSnap(n,c,this.manager),this.manager.emitEvent("magnet:snap",c),this.manager.emitEvent("magnet:pull",c))}}},{key:"getBasisComponent",value:function(){return _t}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var qt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{path:[],point:0,invalidated:!1}}}]),a}(f));var Ht=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{target:p.ZERO,velocity:3,strictness:.01}}}]),a}(f));var Gt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{target:p.ZERO,turnRate:180,strictness:.05}}}]),a}(f));var Xt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data,i=r.position,o=r.velocityTarget,a=r.rotationTarget,s=r.pathFollower,u=W(i.position),c=W(o.target),l=W(s.path);if(s.invalidated){0===l.length&&(o.target=u,s.point=0);for(var f=p.squareDistance(u,W(l[0])),h=0,d=1;d<l.length;d++){var v=W(l[d]),y=p.distance(u,v);y<f&&(f=y,h=d)}s.point=h+1,s.invalidated=!1}if(this.checkRelativeThreshold(c,W(i.position),o.strictness)&&s.point<l.length&&s.point++,s.point<l.length){var m=l[s.point];o.target=m,a.target=m}else this.manager.emitEvent("pathFollower:done",n)}},{key:"checkRelativeThreshold",value:function(t,e,n){return Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n}},{key:"getBasisComponent",value:function(){return qt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(Gt),t.add(Ht),t}}]),a}(F);const Vt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),a}(f));var Yt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=W(e.data.position.position);this.virtualCanvas.line(n.addConstant(-1,0),n.addConstant(1,0),"#ff0000"),this.virtualCanvas.line(n.addConstant(0,-1),n.addConstant(0,1),"#ff0000")}},{key:"getBasisComponent",value:function(){return Vt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var $t=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.position.position,i=n.data.range.range,o=n.data.rangeDisplay,a=o.strokeStyle,s=o.fillStyle,u=o.lineWidth,c=o.offset;this.virtualCanvas.drawCircle(W(r).add(W(c)),i,s,a,u>=1?u:void 0)}},{key:"getBasisComponent",value:function(){return x}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(k),t}}]),a}(F);var Kt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{delta:p.ZERO,fillColor:"#555555",strokeColor:"#55555500"}}}]),a}(f));var Jt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.position.position,i=n.data.region,o=W(i.delta),a=W(i.fillColor),s=W(i.strokeColor),u=W(r);this.virtualCanvas.drawRectangle(u.subtract(o),u.add(o),a,s)}},{key:"getBasisComponent",value:function(){return Kt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);const Qt=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),a}(f));var te,ee=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.rotation.rotation,i=n.data.position.position,o=p.fromAngle(W(r)).scale(2),a=W(i).add(o);this.virtualCanvas.line(W(i),a,"#ff0000")}},{key:"getBasisComponent",value:function(){return Qt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(y),t}}]),a}(F);var ne=pt(Gt)(te=vt([y,v])(te=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.position,i=n.data.rotationTarget,o=n.data.rotation;if(void 0!==i&&void 0!==W(i.target)){var a=W(i.target).subtract(W(r.position)),s=(W(o.rotation)%360+360)%360,u=p.fromAngle(s),c=(a.toAngle()+360)%360;i.targetRotation=c;var l=Math.sign(u.determinant(a)),f=Math.abs(s-c),h=Math.min(i.turnRate*t,f);o.rotation=((W(o.rotation)+h*l)%360+360)%360,Math.abs(f)<i.strictness&&this.manager.emitEvent("rotationTarget:reached",n)}}},{key:"checkRelativeThreshold",value:function(t,e,n){return Math.abs(t-e)<n||Math.abs(t+360-e)<n||Math.abs(t-(e+360))<n}}]),a}(F))||te)||te;var re=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{range:1,strokeStyle:"#ff0000ff",fillStyle:"#ffffff00",lineWidth:0,offset:p.ZERO,radius:1}}}]),a}(f));var ie=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.selectionDisplay;this.virtualCanvas.drawCircle(W(r.position),W(i.radius),i.fillStyle,i.strokeStyle,i.lineWidth)}},{key:"getBasisComponent",value:function(){return re}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);const oe=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{rate:1,elapsed:0,count:1,producer:function(){},limit:-1,total:0}}}]),a}(f));var ae,se=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){for(var n=e,r=n.data.spawner;this.checkInterval(t,r);)for(var i=0;i<r.count;i++)(r.limit<0||r.total<r.limit)&&(r.total++,r.producer(n,this.manager))}},{key:"getBasisComponent",value:function(){return oe}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var ue=pt(Tt)(ae=vt([v,y])(ae=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.sprite,i=n.rotation,o=n.position;this.virtualCanvas.drawImage(r.source,W(o.position).add(W(r.offset)),r.size,W(i.rotation)+W(r.rotationOffset),W(r.opacity))}}]),a}(F))||ae)||ae;var ce=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{offset:p.ZERO,parent:null,child:null,index:0}}}]),a}(f));var le=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("stack:attach",!1),this.listen("stack:detach"),this.listen("stack:swap")}},{key:"onEvent",value:function(t,e,n){"stack:attach"===t&&this.handleAttach(e,n),"stack:detach"===t&&this.handleDetach(e),"stack:swap"===t&&this.handleSwap(e)}},{key:"handleAttach",value:function(t,e){var n=e.indexOffset||0,r=this.manager.getEntity(e.parent),i=r;if(null!=r){for(;null!==r&&null!==r.data.stack.child;)r=r.data.stack.child;if(null!==r)for(var o=0;o<n;o++)r=r.data.stack.parent;if(null!==r){var a=r.data,s=a.position,u=a.stack;"stack"in t.data||this.manager.addComponent(t,ce,{offset:u.offset,index:u.index+1});var c=t.data,l=c.position,f=c.stack;l.position=W(s.position).add(W(u.offset)),f.parent=r,this.manager.emitEvent("stack:attached",t,{parent:r})}else null!==i&&this.manager.emitEvent("stack:attach",t,{parent:i})}}},{key:"handleSwap",value:function(t){var e=t,n=e.data.stack,r=n.parent;if(null!==r){var i=r.data.stack;n.parent=r.data.stack.parent,i.child=n.child,n.child=r,n.index--,i.index++,i.parent=e,null!==n.parent&&(n.parent.data.stack.child=e),null!==i.child&&(i.child.data.stack.parent=r)}}},{key:"handleDetach",value:function(t){if("stack"in t.data){var e=t.data.stack;if(null!==e.parent){var n=e.parent;e.parent=null,e.index=0,n.data.stack.child=null,this.manager.emitEvent("stack:detached",t,{oldParent:n})}}}},{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.stack;if(null!==i.parent){var o=i.parent.data.position;r.position=W(o.position).add(W(i.offset))}}},{key:"getBasisComponent",value:function(){return ce}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);const fe=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{text:"Sample text",style:"#000000ff",size:1,font:"Montserrat",align:"center"}}}]),a}(f));var he=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.textRender,i=n.position;this.virtualCanvas.drawText(W(r.text),W(i.position),r.style,r.size,r.font,r.align)}},{key:"getBasisComponent",value:function(){return fe}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var de=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.velocity;r.position=W(r.position).addScaled(W(i.velocity),t)}},{key:"getBasisComponent",value:function(){return L}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),a}(F);var pe=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data,i=r.position,o=r.velocity,a=r.velocityTarget,s=W(a.target);if(void 0!==s){var u=s.subtract(W(i.position)).normalize().normalize().scale(a.velocity);if(this.checkRelativeThreshold(s,W(i.position),u.magnitude()*t))return this.manager.emitEvent("velocityTarget:reached",n),i.position=s,void(o.velocity=p.ZERO);this.checkRelativeThreshold(s,W(i.position),a.strictness)?o.velocity=p.ZERO:o.velocity=u}}},{key:"checkRelativeThreshold",value:function(t,e,n){return Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n}},{key:"getBasisComponent",value:function(){return Ht}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(L),t}}]),a}(F);function ve(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ye=function(){function t(e,n,r){(0,i.Z)(this,t),this.positions=void 0,this.owners=void 0,this.entities=void 0,this.minimumBound=void 0,this.maximumBound=void 0,this.yScale=void 0,this.positions=new Map,this.owners=new Map,this.entities=new Set,this.minimumBound=e,this.maximumBound=n,this.yScale=this.maximumBound.x-this.minimumBound.x,r.listenEvent("ecs:delete",this.listener.bind(this))}return(0,o.Z)(t,[{key:"getCoordinate",value:function(t){var e=t.x-this.minimumBound.x;return(t.y-this.minimumBound.y)*(this.maximumBound.x-this.minimumBound.x)+e}},{key:"listener",value:function(t){var e=t.entity.id;if(this.owners.has(e)){var n,r=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ve(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ve(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.owners.get(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;this.positions.delete(i)}}catch(t){r.e(t)}finally{r.f()}this.owners.delete(e)}this.entities.delete(e)}},{key:"clear",value:function(){this.positions.clear()}},{key:"checkArea",value:function(t,e){for(var n=t.y;n<e.y;n++)for(var r=t.x;r<e.x;r++)if(this.hasEntityAt(new p(r,n)))return!1;return!0}},{key:"getEntityAt",value:function(t){var e=this.getCoordinate(t);return this.positions.has(e)?this.positions.get(e):null}},{key:"hasEntityAt",value:function(t){var e=this.getCoordinate(t);return this.positions.has(e)}},{key:"createEntityLink",value:function(t,e){if(this.hasEntityAt(t))console.warn("Overlapping entity at ".concat(t.toString()));else{var n=this.getCoordinate(t);this.positions.set(n,e),this.entities.add(e.id),this.owners.has(e.id)||this.owners.set(e.id,new Set),this.owners.get(e.id).add(n)}}},{key:"region",value:function(t,e,n){for(var r=t.y;r<e.y;r++)for(var i=t.x;i<e.x;i++){var o=t.addConstant(i,r);this.createEntityLink(o,n)}}},{key:"getNeighbors",value:function(t){for(var e=t.x,n=t.y,r=[],i=-1;i<=1;i++)for(var o=-1;o<=1;o++)if(!(e+i>this.maximumBound.x||e+i<this.minimumBound.x||n+o>this.maximumBound.y||n+o<this.minimumBound.y||0==e&&0==n)){var a=new p(e+i,n+o);this.hasEntityAt(a)&&r.push(this.getEntityAt(a))}return r}},{key:"isBlocked",value:function(t){return this.hasEntityAt(t)}}]),t}(),me=function(){function t(e){(0,i.Z)(this,t),this.eventQueue=[],this.ecs=void 0,this.virtualCanvas=void 0,this.lastTime=void 0,this.entityMap=void 0,this.running=void 0,this.parentElement=void 0,this.virtualSize=void 0,this.keys=void 0,this.mouse=void 0,this.paused=!1,this.timeScale=1,this.keySet=void 0,this.mouseAction=void 0,this.clicksPerFrame=void 0,this.actionSet=void 0,this.selection=-1,this.firstLoad=!0,this.virtualSize=e,this.ecs=new O,this.virtualCanvas=new D(e),this.entityMap=new ye(p.ZERO,e,this.ecs),this.running=!0,this.keySet=new Set,this.keys=new B,this.mouse=new T,this.setSelection=this.setSelection.bind(this),this.getSelection=this.getSelection.bind(this)}return(0,o.Z)(t,[{key:"invalidateSelection",value:function(){this.selection=-1}},{key:"getSelection",value:function(){if(-1===this.selection)return null;var t=this.ecs.getEntity(this.selection,!0);return null==t?null:t}},{key:"setSelection",value:function(t){this.selection=t;for(var e=this.ecs.getEntityIDsWithComponent(C),n=0;n<e.length;n++)this.ecs.removeComponent(e[n],C),this.ecs.hasComponent(e[n],k)&&this.ecs.removeComponent(e[n],x);-1!==t&&(this.ecs.addComponent(t,C),this.ecs.hasComponent(t,k)&&this.ecs.addComponent(t,x))}},{key:"findCanvas",value:function(){this.virtualCanvas.findCanvas()}},{key:"getMousePosition",value:function(){return this.mouse.getMousePosition()}},{key:"getMouseAction",value:function(){return this.mouseAction}},{key:"updateInput",value:function(t){this.mouseAction="none",this.clicksPerFrame=0,this.keySet.clear(),this.mouse.update(),this.keys.update()}},{key:"clearMouse",value:function(){this.mouseAction="none"}},{key:"install",value:function(t){this.virtualCanvas.install(t),this.lastTime=performance.now(),this.parentElement=t,this.firstLoad&&this.firstInit(t)}},{key:"onFirstInit",value:function(){}},{key:"firstInit",value:function(t){var e=this;this.firstLoad=!1,this.initSystems(),this.mouse.install(t,this.virtualCanvas),this.keys.install(),this.mouse.addListener((function(t){t.leftDown&&(e.mouseAction="click",e.clicksPerFrame++)})),this.keys.addListener((function(t){t.down&&e.keySet.add(t.key)}))}},{key:"uninstall",value:function(){this.virtualCanvas.uninstall(),this.keys.uninstall(),this.ecs.clear(),this.parentElement=null}},{key:"addSystems",value:function(){}},{key:"initSystems",value:function(){this.ecs.createSystem(new et(this.mouse.getMousePosition),-5),this.ecs.createSystem(new rt,-5),this.ecs.createSystem(new st,-5),this.ecs.createSystem(new ot,-5),this.ecs.createSystem(new ct,-5),this.ecs.createSystem(new I,-5),this.ecs.createSystem(new St,-2),this.ecs.createSystem(new se,-1),this.ecs.createSystem(new jt,-1),this.ecs.createSystem(new Xt,0),this.ecs.createSystem(new le,0),this.ecs.createSystem(new pe,0),this.ecs.createSystem(new ne,0),this.ecs.createSystem(new Ut,0),this.ecs.createSystem(new ft(this.mouse.getMousePosition),0),this.ecs.createSystem(new mt(this.entityMap),0),this.ecs.createSystem(new U),this.ecs.createSystem(new de),this.ecs.createSystem(new It(this.virtualCanvas),41),this.ecs.createSystem(new Pt,40),this.ecs.createSystem(new $t(this.virtualCanvas),49),this.ecs.createSystem(new ue(this.virtualCanvas),50),this.ecs.createSystem(new X(this.virtualCanvas),50),this.ecs.createSystem(new Ct(this.virtualCanvas),50),this.ecs.createSystem(new Jt(this.virtualCanvas),54),this.ecs.createSystem(new he(this.virtualCanvas),55),this.ecs.createSystem(new Y(this.mouse.getMousePosition,this.virtualCanvas),59),this.ecs.createSystem(new ie(this.virtualCanvas),59),this.ecs.createSystem(new ee(this.virtualCanvas),60),this.ecs.createSystem(new Yt(this.virtualCanvas),60),this.addSystems()}},{key:"updateLastTime",value:function(t){this.lastTime=t}},{key:"updateRawTime",value:function(t){var e=t-this.lastTime;this.lastTime=t,this.update(e/1e3)}},{key:"update",value:function(t){this.updateInput(t),this.virtualCanvas.clear(),this.paused?this.ecs.update(0,this):this.ecs.update(t*this.timeScale,this),this.onUpdate(t*this.timeScale)}},{key:"onUpdate",value:function(t){}},{key:"isRunning",value:function(){return this.running}},{key:"preStart",value:function(){}}]),t}();function ge(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return we(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ze=function(){function t(){(0,i.Z)(this,t),this.creators=void 0,this.mutators=void 0,this.renderers=void 0,this.particles=void 0,this.nextParticle=0}return(0,o.Z)(t,[{key:"addEffectManager",value:function(t,e){this.creators.has(t)||this.creators.set(t,e),this.mutators.has(t)||this.mutators.set(t,e),this.renderers.has(t)||this.renderers.set(t,e)}},{key:"addEffect",value:function(t,e,n,r){this.creators.has(t)||this.creators.set(t,e),this.mutators.has(t)||this.mutators.set(t,r),this.renderers.has(t)||this.renderers.set(t,n)}},{key:"createEffect",value:function(t,e,n){this.particles.set(this.nextParticle++,this.creators.get(t).create(e,n))}},{key:"draw",value:function(t,e){var n,r=ge(this.particles.keys());try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.particles.get(i);this.renderers.get(o.effect).draw(o,t,e)}}catch(t){r.e(t)}finally{r.f()}}},{key:"update",value:function(t,e){var n,r=ge(this.particles.keys());try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.particles.get(i);this.mutators.get(o.effect).update(o,t,e)}}catch(t){r.e(t)}finally{r.f()}}}]),t}();const ke=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),a}(f));var Re,Ce,xe;const Se=new(R((xe=Ce=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;return(0,i.Z)(this,a),t=r.call(this),void 0===a.NO_TEXTURE&&(a.NO_TEXTURE=new q("assets/notex.png",p.matching(32))),t}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{source:a.NO_TEXTURE,offset:p.ZERO}}}]),a}(f),Ce.NO_TEXTURE=void 0,Re=xe))||Re);var Ee;var be,Oe=pt(Se)(Ee=vt([dt,v])(Ee=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(t){var e;return(0,i.Z)(this,a),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,o.Z)(a,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.turretBase,i=n.footprint,o=n.position;this.virtualCanvas.drawImage(r.source,W(o.position),p.matching(1.5*i.size))}}]),a}(F))||Ee)||Ee,Be=function t(){(0,i.Z)(this,t),this.speed=5,this.damage=5,this.splashRadius=.01};Be.DEFAULT=new Be;const Me=new(R(be=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{rate:1,elapsed:0,projectile:null,target:null,canFire:!0,barrelOffsets:[p.ZERO],barrel:0,fireStrictness:1,arcReached:!1,projectileType:Be.DEFAULT,tags:[]}}}]),a}(f))||be);var Te;const Pe=new(R(Te=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{tags:["ground"]}}}]),a}(f))||Te);var De;var Ne,Ae=pt(Me)(De=vt([Gt])(De=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;(0,i.Z)(this,a);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).creeps=void 0,t}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("rotationTarget:reached",!0)}},{key:"onEvent",value:function(t,e){e.data.weapon.arcReached=!0}},{key:"systemUpdate",value:function(){this.creeps=this.manager.getEntitiesWithComponent(Pe)}},{key:"updateEntity",value:function(t,e){var n=e,r=n.data,i=r.weapon,o=r.rotationTarget;!i.canFire&&this.checkInterval(t,i)&&(i.canFire=!0),void 0===i.target&&(i.target=null);for(var a=i.target,s=this.creepInRange(n,a,1),u=0;u<this.creeps.length;u++){var c=this.creeps[u];if(this.isValidCreep(c)){var f=(0,l.intersection)(n.data.weapon.tags,c.data.creep.tags);this.creepInRange(n,c,1)&&f.length>0&&(this.isValidCreep(a)&&s?c.data.pathFollower.point>a.data.pathFollower.point&&(a=this.creeps[u]):a=c)}}i.target=a,null!==a&&a.active&&(o.target=a.data.position.position,i.canFire&&this.creepInRange(n,a)&&i.arcReached&&(i.projectile(n,this.manager),i.canFire=!1,i.barrel=(i.barrel+1)%i.barrelOffsets.length,this.manager.emitEvent("weapon:fire",n)),i.arcReached=!1)}},{key:"creepInRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.isValidCreep(e))return!1;var r=W(t.data.position.position),i=W(e.data.position.position);return J(r,t.data.range.range+n,i)}},{key:"isValidCreep",value:function(t){return null!=t&&t.active&&void 0!==t.data.creep}}]),a}(F))||De)||De;const je=new(R(Ne=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{damage:1}}}]),a}(f))||Ne);var ze;const Fe=new(R(ze=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{target:null}}}]),a}(f))||ze);var Ie;var _e,We=pt(Fe)(Ie=vt([Ht,je])(Ie=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("velocityTarget:reached")}},{key:"onEvent",value:function(t,e){if(e.active){var n=e.data,r=n.damageTarget,i=n.damage;r.target.data.health.health-=i.damage,this.manager.removeEntity(e)}else this.manager.removeEntity(e)}}]),a}(F))||Ie)||Ie,Le=n(757),Ue=n.n(Le),qe=new(function(){function t(){(0,i.Z)(this,t)}return(0,o.Z)(t,[{key:"gaussian",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,e=0,n=0;n<t;n++)e+=Math.random();return e/t-.5}},{key:"withoutReplacement",value:function(t){for(var e=[],n=1;n<=t;n++)e[n-1]=n;return this.shuffleArray(e),e}},{key:"withoutReplacementGenerator",value:function(t){for(var e=[],n=1;n<=t;n++)e[n-1]=n;return this.shuffleArray(e),Ue().mark((function t(){var n;return Ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.length)){t.next=7;break}return t.next=4,e[n];case 4:n++,t.next=1;break;case 7:return t.next=10,0;case 10:t.next=7;break;case 12:case"end":return t.stop()}}),t)}))()}},{key:"shuffleArray",value:function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}}}]),t}());const He=new(R(_e=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"defaultData",value:function(){return{radius:1,target:null,tags:["ground"]}}}]),a}(f))||_e);var Ge;var Xe=pt(He)(Ge=vt([Ht,je])(Ge=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){var t;(0,i.Z)(this,a);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).targets=[],t.fireTex=new q("assets/Fire.png"),t}return(0,o.Z)(a,[{key:"onManagerAwake",value:function(){this.listen("velocityTarget:reached")}},{key:"systemUpdate",value:function(){this.targets=this.manager.getEntitiesWithComponent(Pe)}},{key:"onEvent",value:function(t,e){if(e.active){for(var n=e.data,r=n.splashDamage,i=n.damage,o=0;o<this.targets.length;o++){var a=this.targets[o];a.active&&void 0!==a.data.creep&&(r.target.active&&void 0!==r.target.data.position||J(W(e.data.position.position),r.radius,W(a.data.position.position))&&(0,l.intersection)(r.tags,a.data.creep.tags).length>0&&(a.data.health.health-=i.damage),J(W(r.target.data.position.position),r.radius,W(a.data.position.position))&&(0,l.intersection)(r.tags,a.data.creep.tags).length>0&&(a.data.health.health-=i.damage))}this.createExplosion(e.data.position.position,r.radius),this.manager.removeEntity(e)}else this.manager.removeEntity(e)}},{key:"createExplosion",value:function(t,e){var n=this,r=W(t),i=this.manager.createEntity();this.manager.addComponent(i,v,{position:r}),this.manager.addComponent(i,Et,{lifetime:1}),this.manager.addComponent(i,oe,{count:5,rate:.1,producer:function(){var t=n.manager.createEntity(),i=p.fromAngle(720*qe.gaussian(),e);n.manager.addComponent(t,v,{position:r}),n.manager.addComponent(t,L,{velocity:i}),n.manager.addComponent(t,y),n.manager.addComponent(t,Et,{lifetime:1}),n.manager.addComponent(t,Tt,{source:n.fireTex,size:p.matching(.25)}),n.manager.addComponent(t,bt)}})}}]),a}(F))||Ge)||Ge,Ve={name:"Rifle Tower",description:"Short-range tower",size:2,range:4,rotationRate:360,fireRate:1,cost:5,projectile:{speed:50,damage:2,splashRadius:0},levelSprites:["tower-1-1","tower-1-2","tower-1-3"],tags:["ground"],upgrades:[{cost:10,dataDelta:{weapon:{projectileType:{damage:5},rate:.8},sprite:{source:new q("assets/turret-1-2.png")}}},{cost:20,dataDelta:{weapon:{projectileType:{damage:7}},sprite:{source:new q("assets/turret-1-3.png")},range:{range:5}}}],projectileSpawner:"bullet"},Ye={name:"MissileTower",description:"Long-range splash tower",size:2,range:8,rotationRate:90,fireRate:1,cost:20,projectile:{speed:20,damage:5,splashRadius:1},levelSprites:["tower-2-1","tower-2-2","tower-2-3"],tags:["ground"],upgrades:[{cost:20,dataDelta:{weapon:{projectileType:{damage:10,splashRadius:1.25}},sprite:{source:new q("assets/turret-2-2.png")}}},{cost:40,dataDelta:{weapon:{projectileType:{damage:10,splashRadius:2}},sprite:{source:new q("assets/turret-2-3.png")}}}],projectileSpawner:"missile"},$e=new q("assets/turret-3-2.png"),Ke=new q("assets/turret-3-3.png"),Je={name:"Swarmer Tower",description:"Rapidfire Anti-Air Tower",size:2,range:5,rotationRate:270,fireRate:.5,cost:20,projectile:{speed:20,damage:5,splashRadius:.2},barrels:[new p(.2,.1),new p(.2,.1)],levelSprites:["tower-3-1","tower-3-2","tower-3-3"],tags:["air"],upgrades:[{cost:25,dataDelta:{weapon:{rate:.25,range:6},sprite:{source:$e}}},{cost:50,dataDelta:{weapon:{range:7,projectileType:{damage:10}},sprite:{source:Ke},rotationTarget:{turnRate:360}}}],projectileSpawner:"swarmMissile"},Qe={name:"Sniper Tower",description:"Long-range slow-firing tower.",size:2,range:12,rotationRate:45,fireRate:3,cost:40,projectile:{speed:40,damage:10,splashRadius:0},levelSprites:["tower-4-1","tower-4-2","tower-4-3"],tags:["air","ground"],upgrades:[{cost:50,dataDelta:{weapon:{projectileType:{damage:15},rate:2.5},rotationTarget:{turnRate:60},range:{range:13},sprite:{source:new q("assets/turret-4-2.png")}}},{cost:100,dataDelta:{weapon:{projectileType:{damage:20,splashRadius:.5}},rotationTarget:{turnRate:90},range:{range:15},sprite:{source:new q("assets/turret-4-3.png")}}}],projectileSpawner:"bullet"};function tn(t,e,n,r,i,o){var a=t.createEntity();t.addComponent(a,v,{position:e}),t.addComponent(a,fe,{text:n,style:r,size:i,align:o})}function en(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=t.createEntity();return t.addComponent(o,v,{position:e}),!r&&n?t.addComponent(o,Kt,{delta:n}):(t.addComponent(o,A,{delta:n}),t.addComponent(o,N,{action:i}),t.addComponent(o,V,{})),o}const nn=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{cost:0,dataDelta:{}}}}]),a}(f));function rn(t,e){var n=e.createEntity(),r=p.fromAngle(720*qe.gaussian()).scale(qe.gaussian()),i=W(t.data.position.position);e.addComponent(n,v,{position:i.add(r)}),e.addComponent(n,L,{velocity:r}),e.addComponent(n,y,{rotation:720*qe.gaussian()}),e.addComponent(n,Tt,{size:p.matching(.5),source:new q("assets/Gear.png")}),e.addComponent(n,Et),e.addComponent(n,bt)}var on=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{name:"Unknown"}}}]),a}(f));var an=new(function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{value:0}}}]),a}(f)),sn=new q("assets/Bullet.png");function un(t,e){var n=e.createEntity(),r=e.getEntity(n),i=t.data.weapon.target,o=t.data,a=o.weapon,s=o.range,u=p.ZERO;return u=(u=(u=u.add(t.data.weapon.barrelOffsets[t.data.weapon.barrel])).rotate(W(t.data.rotation.rotation))).add(W(t.data.position.position)),e.addComponent(r,v,{position:u}),e.addComponent(r,y,{rotation:t.data.rotation.rotation}),e.addComponent(r,Gt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position}}),e.addComponent(r,L),e.addComponent(r,Ht,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position},velocity:t.data.weapon.projectileType.speed}),e.addComponent(r,Tt,{source:sn,rotationOffset:90}),e.addComponent(r,je,{damage:t.data.weapon.projectileType.damage}),t.data.weapon.projectileType.splashRadius>=.01?e.addComponent(r,He,{target:a.target,radius:a.projectileType.splashRadius}):e.addComponent(r,Fe,{target:a.target}),e.addComponent(r,Et,{lifetime:s.range/a.projectileType.speed*1.2}),r}function cn(t,e){var n=p.ZERO;"rotation"in t.data&&(n=p.fromAngle(W(t.data.rotation.rotation))),"velocity"in t.data&&(n=W(t.data.velocity.velocity));var r=n.scale(-1).rotate(30*qe.gaussian()).scale(1+qe.gaussian()/2);if(!r.equals(p.ZERO)){var i=e.createEntity();return e.addComponent(i,v,{position:t.data.position.position}),e.addComponent(i,y),e.addComponent(i,L,{velocity:r}),e.addComponent(i,Et),e.addComponent(i,Tt,{size:p.matching(.25),source:new q("assets/smoke.png")}),e.addComponent(i,bt),e.getEntity(i)}}var ln=new q("assets/Missile.png");function fn(t,e){var n=e.createEntity(),r=e.getEntity(n),i=t.data.weapon.target,o=t.data,a=o.weapon,s=o.range,u=p.ZERO;return u=(u=(u=u.add(t.data.weapon.barrelOffsets[t.data.weapon.barrel])).rotate(W(t.data.rotation.rotation))).add(W(t.data.position.position)),e.addComponent(r,v,{position:u}),e.addComponent(r,y,{rotation:t.data.rotation.rotation}),e.addComponent(r,Gt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position}}),e.addComponent(r,L),e.addComponent(r,Ht,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position},velocity:t.data.weapon.projectileType.speed}),e.addComponent(r,Tt,{source:ln,rotationOffset:90}),e.addComponent(r,oe,{producer:cn,count:1,rate:.1}),e.addComponent(r,je,{damage:t.data.weapon.projectileType.damage}),t.data.weapon.projectileType.splashRadius>=.01?e.addComponent(r,He,{target:a.target,radius:a.projectileType.splashRadius}):e.addComponent(r,Fe,{target:a.target}),e.addComponent(r,Et,{lifetime:s.range/a.projectileType.speed*1.2}),r}var hn=new q("assets/SwarmMissile.png");function dn(t,e){var n=e.createEntity(),r=e.getEntity(n),i=t.data.weapon.target,o=t.data,a=o.weapon,s=o.range,u=p.ZERO;return u=(u=(u=u.add(t.data.weapon.barrelOffsets[t.data.weapon.barrel])).rotate(W(t.data.rotation.rotation))).add(W(t.data.position.position)),e.addComponent(r,v,{position:u}),e.addComponent(r,y,{rotation:t.data.rotation.rotation}),e.addComponent(r,Gt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position}}),e.addComponent(r,L),e.addComponent(r,Ht,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position},velocity:t.data.weapon.projectileType.speed}),e.addComponent(r,Tt,{source:hn,rotationOffset:90}),e.addComponent(r,oe,{producer:cn,count:1,rate:.1}),e.addComponent(r,je,{damage:t.data.weapon.projectileType.damage}),t.data.weapon.projectileType.splashRadius>=.01?e.addComponent(r,He,{target:a.target,radius:a.projectileType.splashRadius}):e.addComponent(r,Fe,{target:a.target}),e.addComponent(r,Et,{lifetime:s.range/a.projectileType.speed*1.2}),r}function pn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function yn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vn(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var mn=function(){function t(e,n){(0,i.Z)(this,t),this.model=e,this.ecs=n,this.towerTextures={"tower-1-1":new q("assets/turret-1-1.png"),"tower-1-2":new q("assets/turret-1-2.png"),"tower-1-3":new q("assets/turret-1-3.png"),"tower-2-1":new q("assets/turret-2-1.png"),"tower-2-2":new q("assets/turret-2-2.png"),"tower-2-3":new q("assets/turret-2-3.png"),"tower-3-1":new q("assets/turret-3-1.png"),"tower-3-2":new q("assets/turret-3-2.png"),"tower-3-3":new q("assets/turret-3-3.png"),"tower-4-1":new q("assets/turret-4-1.png"),"tower-4-2":new q("assets/turret-4-2.png"),"tower-4-3":new q("assets/turret-4-3.png")},this.towers=new Map,this.upgrades=new Map,this.projectileSpawners={bullet:un,missile:fn,swarmMissile:dn},this.baseSprite=new q("assets/turret-base.gif")}return(0,o.Z)(t,[{key:"add",value:function(t,e){this.towers.set(t,e),this.upgrades.set(t,this.combineUpgrades(e))}},{key:"getTower",value:function(t){return this.towers.get(t)}},{key:"createDemoTower",value:function(t,e){var n=this,r=this.towers.get(e),i=this.ecs.createEntity();this.ecs.addComponent(i,v,{position:function(){return n.model.getMousePosition().ceil().addConstant((1-r.size)/2,(1-r.size)/2)}}),this.ecs.addComponent(i,k,{range:r.range}),this.ecs.addComponent(i,y);var o=r.size%2==0?p.matching(-.5):p.ZERO;return this.ecs.addComponent(i,x,{offset:o.addConstant(.5,.5)}),this.ecs.addComponent(i,Tt,{source:this.towerTextures[r.levelSprites[0]],size:p.matching(r.size)}),this.ecs.addComponent(i,an,{value:r.cost}),this.ecs.addComponent(i,Me,{projectile:un,rate:r.fireRate,damage:r.projectile.damage,tags:r.tags,elapsed:-1}),i}},{key:"createTower",value:function(t,e){var n=this,r=this.towers.get(e),i=this.ecs.createEntity(),o=this.ecs.getEntity(i);return this.ecs.addComponent(o,v,{position:t}),this.ecs.addComponent(i,v,{position:W(t).ceil().addConstant((1-r.size)/2,(1-r.size)/2)}),this.ecs.addComponent(i,k,{range:r.range}),this.ecs.addComponent(i,y),this.ecs.addComponent(i,Gt,{turnRate:r.rotationRate,strictness:1}),this.ecs.addComponent(i,on,{name:r.name}),this.ecs.addComponent(i,A,{delta:p.matching(r.size/2),offset:p.matching(-.5)}),this.ecs.addComponent(i,N,{action:function(){n.model.setSelection(i)}}),this.ecs.addComponent(i,Tt,{source:this.towerTextures[r.levelSprites[0]],size:p.matching(r.size),rotationOffset:90}),this.ecs.addComponent(i,dt,{source:this.towerTextures[r.levelSprites[0]],size:r.size}),this.ecs.addComponent(i,Se,{source:this.baseSprite}),console.log(r.tags),this.ecs.addComponent(i,Me,{projectile:this.projectileSpawners[r.projectileSpawner],rate:r.fireRate,damage:r.projectile.damage,barrels:r.barrels||[p.ZERO],tags:r.tags,projectileType:yn({},r.projectile)}),this.ecs.addComponent(i,ke),this.ecs.addComponent(i,an,{value:Math.floor(.8*r.cost)}),this.ecs.addComponent(i,nn,yn({},(0,l.cloneDeep)(this.upgrades.get(e)))),i}},{key:"combineUpgrades",value:function(t){var e,n={},r=n,i=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return pn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t.upgrades.slice());try{for(i.s();!(e=i.n()).done;){var o=e.value;Object.assign(r,o),r.dataDelta=yn({},r.dataDelta),r.dataDelta.upgrade=yn({},r.dataDelta.upgrade),r=r.dataDelta.upgrade}}catch(t){i.e(t)}finally{i.f()}return r.cost=0,n}},{key:"canPlace",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.towers.get(e);if(null==r)return!1;if(console.debug("Tower null check passed"),this.model.money<r.cost)return!1;if(console.debug("Tower money check passed"),t.x<11||t.x+r.size>40)return!1;if(t.y<1||t.y+r.size>30)return!1;var i=this.checkCollision(t.floor(),r),o=i.collides,a=i.blocked;if(o)return!1;console.debug("Tower collision check passed");var s=this.model.getPath().findEastWest(a);if(0==s.length)return!1;console.debug("Tower east-west path check passed");var u=this.model.getPath().findNorthSouth(a);return 0!=u.length&&(console.debug("Tower north-south path check passed"),n||(this.model.setEastWestPath(s),this.model.setNorthSouthPath(u),this.ecs.getEntitiesWithComponent(Pe).forEach((function(t){void 0!==t&&(t.data.pathFollower.invalidated=!0)}))),!0)}},{key:"checkCollision",value:function(t,e){for(var n=Math.floor((e.size-1)/2),r=new p(t.x-n,t.y-n),i=Math.floor(e.size/2),o=new p(t.x+i,t.y+i),a=new Set,s=r.x;s<=o.x;s++)for(var u=r.y;u<=o.y;u++){var c=new p(s,u);if(this.model.getMap().hasEntityAt(c))return a.clear(),{collides:!0,blocked:a};a.add(new p(s,u))}return{collides:!1,blocked:a}}}]),t}(),gn=function(){function t(e){(0,i.Z)(this,t),this.offset=void 0,this.offset=e}return(0,o.Z)(t,null,[{key:"getAllCardinal",value:function(){return void 0===this.cardinal&&(this.cardinal=new Set,this.cardinal.add(this.NORTH),this.cardinal.add(this.EAST),this.cardinal.add(this.SOUTH),this.cardinal.add(this.WEST)),this.cardinal}},{key:"getAllDirections",value:function(){return void 0===this.all&&(this.all=new Set,this.all.add(this.NORTH),this.all.add(this.NORTHEAST),this.all.add(this.EAST),this.all.add(this.SOUTHEAST),this.all.add(this.SOUTH),this.all.add(this.SOUTHWEST),this.all.add(this.WEST),this.all.add(this.NORTHWEST)),this.all}}]),t}();function wn(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Zn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Zn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}gn.NORTH=new gn(new p(0,-1)),gn.NORTHEAST=new gn(new p(1,-1)),gn.EAST=new gn(new p(1,0)),gn.SOUTHEAST=new gn(new p(1,1)),gn.SOUTH=new gn(new p(0,1)),gn.SOUTHWEST=new gn(new p(-1,1)),gn.WEST=new gn(new p(-1,0)),gn.NORTHWEST=new gn(new p(-1,-1)),gn.all=void 0,gn.cardinal=void 0;var kn=function t(e,n){(0,i.Z)(this,t),this.parent=void 0,this.position=void 0,this.parent=e,this.position=n},Rn=function(){function t(){(0,i.Z)(this,t)}return(0,o.Z)(t,null,[{key:"findPath",value:function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:gn.getAllCardinal(),o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=[new kn(null,n)],l=new Set,f=new Set;s&&s.forEach((function(t){return f.add(t.toString())})),r.forEach((function(t){return l.add(t.toString())}));var h=new Set;for(h=h.add(n.toString());c.length>0;){var d,p=c.splice(0,1)[0],v=p.position,y=wn(i);try{for(y.s();!(d=y.n()).done;){var m=d.value,g=v.add(m.offset);if(void 0!==g){if(!(h.has(g.toString())||(h.add(g.toString()),o&&g.x<o.x||g.y<o.y||a&&g.x>a.x||g.y>a.y||e.isBlocked(g)||f.has(g.toString())))){var w=new kn(p,g);if(l.has(g.toString()))return t.fromPath(w,u);h=h.add(g.toString()),c.push(w)}}else console.error("Something went wrong:"),console.error(JSON.stringify(p)),console.error(JSON.stringify(m)),console.error(c)}}catch(t){y.e(t)}finally{y.f()}}return console.log("No path found."),[]}},{key:"fromPath",value:function(t,e){for(var n=t,r=[];null!=n;)r=[n.position].concat((0,m.Z)(r)),n=n.parent;if(e){for(var i=[r[0]],o=1;o<r.length-1;o++){var a=i[i.length-1],s=r[o],u=r[o+1],c=s.subtract(a).normalize(),l=u.subtract(s).normalize();c.equals(l)||(i.push(s),o++)}return i.push(r[r.length-1]),i}return r}}]),t}(),Cn=function(){function t(e){(0,i.Z)(this,t),this.model=e,this.southEnd=new Set,this.eastEnd=new Set,this.southEnd.add(new p(19,30)),this.southEnd.add(new p(20,30)),this.southEnd.add(new p(21,30)),this.southEnd.add(new p(22,30)),this.southEnd.add(new p(23,30)),this.eastEnd.add(new p(39,13)),this.eastEnd.add(new p(39,14)),this.eastEnd.add(new p(39,15)),this.eastEnd.add(new p(39,16)),this.eastEnd.add(new p(39,17))}return(0,o.Z)(t,[{key:"findEastWest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Rn.findPath(this.model.getMap(),new p(10,15),this.eastEnd,gn.getAllCardinal(),new p(10,0),this.model.getVirtualSize(),t,e);return n}},{key:"findNorthSouth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Rn.findPath(this.model.getMap(),new p(25,0),this.southEnd,gn.getAllCardinal(),new p(10,0),this.model.getVirtualSize(),t,e);return n}}]),t}();function xn(t,e,n){return function(r,i){var o=W(r.data.position.position),a=i.createEntity(),s=W(n);i.addComponent(a,v,{position:o}),i.addComponent(a,L,{velocity:new p(0,0)}),i.addComponent(a,y),i.addComponent(a,Ht,{velocity:5+1.2*s}),i.addComponent(a,Gt,{turnRate:720}),i.addComponent(a,qt,{path:t}),i.addComponent(a,A,{delta:p.matching(.5),offset:p.matching(-.5)}),i.addComponent(a,N,{action:function(t){return e.setSelection(t.id)}}),i.addComponent(a,G,{source:new q("assets/Fast.png"),frames:[.1,.1,.1,.1,.1,.1],size:p.matching(2),frameSize:new p(64,64)}),i.addComponent(a,kt,{health:Math.floor(8*s),maxHealth:Math.floor(8*s)}),i.addComponent(a,wt),i.addComponent(a,Pe,{tags:["ground"]}),i.addComponent(a,on,{name:"Normal Creep"})}}function Sn(t,e,n){return function(r,i){var o=W(r.data.position.position),a=i.createEntity(),s=W(n);i.addComponent(a,v,{position:o}),i.addComponent(a,L,{velocity:new p(0,0)}),i.addComponent(a,y),i.addComponent(a,Ht,{velocity:4+.8*s}),i.addComponent(a,Gt),i.addComponent(a,qt,{path:t}),i.addComponent(a,A,{delta:p.matching(.5),offset:p.matching(-.5)}),i.addComponent(a,N,{action:function(t){return e.setSelection(t.id)}}),i.addComponent(a,G,{source:new q("assets/Flying.png"),frames:[.1,.1,.1],size:p.matching(3),frameSize:new p(64,64)}),i.addComponent(a,kt,{health:Math.floor(.8*s*10),maxHealth:Math.floor(.8*s*10)}),i.addComponent(a,wt),i.addComponent(a,Pe,{tags:["air"]}),i.addComponent(a,on,{name:"Flying Creep"})}}function En(t,e,n){return function(r,i){var o=W(r.data.position.position),a=i.createEntity(),s=W(n);i.addComponent(a,v,{position:o}),i.addComponent(a,L,{velocity:new p(0,0)}),i.addComponent(a,y),i.addComponent(a,Ht,{velocity:3+s}),i.addComponent(a,Gt,{turnRate:360}),i.addComponent(a,qt,{path:t}),i.addComponent(a,A,{delta:p.matching(.5),offset:p.matching(-.5)}),i.addComponent(a,N,{action:function(t){return e.setSelection(t.id)}}),i.addComponent(a,G,{source:new q("assets/Normal.png"),frames:[.1,.1,.1,.1,.1,.1],size:p.matching(2),frameSize:p.matching(64)}),i.addComponent(a,kt,{health:Math.floor(10*s),maxHealth:Math.floor(10*s)}),i.addComponent(a,wt),i.addComponent(a,Pe,{tags:["ground"]}),i.addComponent(a,on,{name:"Normal Creep"})}}var bn=function(){function t(e){var n=this;(0,i.Z)(this,t),this.model=e,this.northNormalCreepGenerator=void 0,this.eastNormalCreepGenerator=void 0,this.northNormalPlusCreepGenerator=void 0,this.eastNormalPlusCreepGenerator=void 0,this.northFastCreepGenerator=void 0,this.eastFastCreepGenerator=void 0,this.northFlyingCreepGenerator=void 0,this.eastFlyingCreepGenerator=void 0,this.statModifier=1,this.wave=0,this.getStatModifier=void 0,this.getStatModifier=this._getStatModifier.bind(this),this.northNormalCreepGenerator=En(e.getNorthSouthPath,e,this.getStatModifier),this.eastNormalCreepGenerator=En(e.getEastWestPath,e,this.getStatModifier),this.eastNormalPlusCreepGenerator=En(e.getEastWestPath,e,(function(){return 1.5*n.getStatModifier()})),this.northNormalPlusCreepGenerator=En(e.getNorthSouthPath,e,(function(){return 1.5*n.getStatModifier()})),this.northFastCreepGenerator=xn(e.getNorthSouthPath,e,this.getStatModifier),this.eastFastCreepGenerator=xn(e.getEastWestPath,e,this.getStatModifier),this.northFlyingCreepGenerator=Sn([new p(25,0),new p(25,30)],e,this.getStatModifier),this.eastFlyingCreepGenerator=Sn([new p(10,15),new p(40,15)],e,this.getStatModifier)}return(0,o.Z)(t,[{key:"nextWave",value:function(){this.wave++,this.statModifier=1+.1*this.wave}},{key:"getNorthWave",value:function(){var t=this.wave%5,e=20+10*Math.floor(this.wave/10);if(this.isNorthWave())switch(t){case 0:case 1:return{count:e,entity:this.northNormalCreepGenerator};case 2:return{count:e,entity:this.northFastCreepGenerator};case 3:return{count:e,entity:this.northNormalPlusCreepGenerator};case 4:return{count:e,entity:this.northFlyingCreepGenerator}}return{count:0,entity:this.northNormalCreepGenerator}}},{key:"getEastWave",value:function(){var t=this.wave%5,e=20+10*Math.floor(this.wave/10);if(this.isEastWave())switch(t){case 0:case 1:return{count:e,entity:this.eastNormalCreepGenerator};case 2:return{count:e,entity:this.eastFastCreepGenerator};case 3:return{count:e,entity:this.eastNormalPlusCreepGenerator};case 4:return{count:e,entity:this.eastFlyingCreepGenerator}}return{count:0,entity:this.eastNormalCreepGenerator}}},{key:"isNorthWave",value:function(){return this.wave%3!=0}},{key:"isEastWave",value:function(){return this.wave%3!=1}},{key:"_getStatModifier",value:function(){return this.statModifier}},{key:"nextNorth",value:function(){return(this.wave+1)%3!=0}},{key:"nextEast",value:function(){return(this.wave+1)%3!=1}}]),t}(),On=n(978),Bn=function(){function t(e,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){};(0,i.Z)(this,t),this.el=void 0,this.ready=!1,this.continue=!1,this.loop=!1,this.start=0,this.end=0,this._playing=!1,this.cutoff=0,this.currentCutoffTimeout=void 0,this.currentLoopTimeout=void 0,this.currentDurationTimeout=void 0,this.el=new Audio(e),this.el.addEventListener("load",function(){r.ready=!0,r.end=Math.min(n,r.el.duration),s(r.getDuration())}.bind(this)),n&&(this.cutoff=n),this.start=a,this.loop=o}return(0,o.Z)(t,[{key:"getDuration",value:function(){return this.end-this.start}},{key:"play",value:function(){var t=this;this.el.play(),this.continue=!0,this.el.currentTime=this.start,this._playing=!0,this.loop?this.currentLoopTimeout=setTimeout((function(){t.continue&&(t.el.currentTime=t.start,t.playRec())}),1e3*this.cutoff):this.cutoff>0?(clearTimeout(this.currentCutoffTimeout),this.currentCutoffTimeout=setTimeout((function(){t.stop()}),1e3*this.cutoff)):(clearTimeout(this.currentDurationTimeout),this.currentDurationTimeout=setTimeout((function(){return t._playing=!1}),1e3*this.el.duration))}},{key:"playRec",value:function(){var t=this;this.currentLoopTimeout=setTimeout((function(){t.continue&&(t.el.currentTime=0,t.playRec())}),1e3*this.cutoff)}},{key:"stop",value:function(){this.el.pause(),this.continue=!1,this._playing=!1,this.el.currentTime=0}},{key:"playing",get:function(){return this._playing}}]),t}();function Mn(){return On.n.getData().audio}var Tn=function(){function t(e,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,i.Z)(this,t),this.pool=void 0,this.ids=void 0,this.duration=void 0;var s=new Bn(n,a,!1,o,(function(t){r.duration=t}));this.pool=[s],this.ids=[];for(var u=1;u<e;u++)this.pool.push(new Bn(n,a,!1,o)),this.ids.push(u)}return(0,o.Z)(t,[{key:"play",value:function(){var t=this,e=this.ids.splice(1,1)[0];void 0!==e&&(this.pool[e].play(),setTimeout((function(){t.ids.push(e)}),this.duration))}}]),t}();function Pn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Dn=function(t){(0,s.Z)(h,t);var e,n,f=(e=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function h(){var t;(0,i.Z)(this,h),(t=f.call(this,new p(40,30))).particleManager=void 0,t.unstructured=void 0,t.lives=20,t.money=30,t.wave=void 0,t.waveSet=void 0,t.persistence=void 0,t._actionMap=void 0,t.eastWestPath=[],t.northSouthPath=void 0,t.actionQueue=void 0,t.mouseEntity=null,t.towerManager=void 0,t.pathChecker=void 0,t.floorTile=new q("assets/FloorTile.png"),t.creepManager=void 0,t.activeTower=null,t.northSpawnerID=-1,t.eastSpawnerID=-1,t.score=0,t.arrow=new q("assets/Arrow.png"),t.getEastWestPath=void 0,t.getNorthSouthPath=void 0,t.first=!0,t.audioLoop=new Bn("assets/loop.mp3",147,!0),t.turretFireSound=new Tn(10,"assets/gun.mp3",.6,2),t.sellSound=new Tn(5,"assets/sell.mp3",0,3),t.creepDeathSound=new Tn(5,"assets/crunch.mp3",0,1),t.creepEscapeSound=new Tn(3,"assets/escape.mp3",0,1),t.buildSound=new Bn("assets/construction.mp3",2),console.log("GM Constructor");var e=On.n.persistence.get((0,a.Z)(t));t.towerManager=new mn((0,a.Z)(t),t.ecs),t.pathChecker=new Cn((0,a.Z)(t)),t.getEastWestPath=t._getEastWestPath.bind((0,a.Z)(t)),t.getNorthSouthPath=t._getNorthSouthPath.bind((0,a.Z)(t)),t.creepManager=new bn((0,a.Z)(t)),t.particleManager=new Ze,t.initParticleEffects();var n=e.keyMap;t._actionMap=new w,t.initActions();for(var r=function(){var e=s[o];t.keys.addKeyListener(n[e],(function(n){n.down&&t._actionMap.invoke(e)}))},o=0,s=Object.keys(n);o<s.length;o++)r();return t.keys.addKeyListener("escape",(function(){t._actionMap.invoke("clear")})),t.keys.addKeyListener("]",(function(e){e.down&&(t.paused=!t.paused)})),t.timeScale=1,t.keys.addKeyListener("[",(function(e){e.down&&(t.timeScale<2?t.timeScale=2:t.timeScale=1)})),t._actionMap.addHandler("sell",t.attemptSell.bind((0,a.Z)(t))),t._actionMap.addHandler("wave",t.sendWave.bind((0,a.Z)(t))),t._actionMap.addHandler("upgrade",t.attemptUpgrade.bind((0,a.Z)(t))),t._actionMap.addHandler("clear",t.clearMouseMode.bind((0,a.Z)(t))),t._actionMap.addHandler("setTower",t.setMouseMode.bind((0,a.Z)(t))),t._actionMap.addHandler("exit",(function(){t.running=!1,t.entityMap.clear(),t.audioLoop.stop(),t.ecs.clear(),On.n.router.requestTransition("home")})),t.mouse.addListener(t.handleClick.bind((0,a.Z)(t))),t.towerManager.add("tower-1",Ve),t.towerManager.add("tower-2",Ye),t.towerManager.add("tower-3",Je),t.towerManager.add("tower-4",Qe),t.ecs.listenEvent("weapon:fire",(function(e){Mn()&&t.turretFireSound.play()})),t.ecs.listenEvent("sellable:sell",(function(e){var n=e.extra.position,r=t.ecs.createEntity();t.ecs.addComponent(r,v,{position:n.position}),t.ecs.addComponent(r,oe,{producer:rn,rate:10,elapsed:10,count:30}),t.ecs.addComponent(r,Et,{lifetime:1.5}),Mn()&&t.sellSound.play()})),t.ecs.listenEvent("pathFollower:done",(function(e){t.lives--,t.ecs.removeEntity(e.entity),Mn()&&t.creepEscapeSound.play(),t.lives<=0&&(t.running=!1,t.entityMap.clear(),t.audioLoop.stop(),t.ecs.clear(),On.n.router.requestTransition("scores",!1,{score:t.score}))})),t.ecs.listenEvent("health:die",(function(e){var n=e.extra.position;t.money+=5,t.score+=5;var r=t.ecs.createEntity();t.ecs.addComponent(r,v,{position:n.position}),t.ecs.addComponent(r,L,{velocity:new p(0,-.5)}),t.ecs.addComponent(r,fe,{text:"+5",style:"#ffffff"}),t.ecs.addComponent(r,oe,{producer:rn,rate:10,elapsed:10,count:30}),t.ecs.addComponent(r,Et,{lifetime:1.5}),Mn()&&t.creepDeathSound.play()})),t}return(0,o.Z)(h,[{key:"sendWave",value:function(){var t=this.ecs.getEntity(this.northSpawnerID),e=this.ecs.getEntity(this.eastSpawnerID),n=t.data,r=n.spawner,i=n.sprite,o=e.data,a=o.spawner,s=o.sprite;if(!(r.total<r.limit||a.total<a.limit)){var u=this.creepManager.getEastWave(),c=u.count,l=u.entity;a.producer=l,a.rate=1/this.creepManager.getStatModifier(),a.total=0,a.limit=c,this.creepManager.nextEast()?s.size=p.ONES:s.size=p.ZERO,console.log("East count "+c);var f=this.creepManager.getNorthWave(),h=f.count,d=f.entity;r.producer=d,r.rate=1/this.creepManager.getStatModifier(),r.total=0,r.limit=h,this.creepManager.nextNorth()?i.size=p.ONES:i.size=p.ZERO,console.log("North count "+h),this.creepManager.nextWave()}}},{key:"initActions",value:function(){this._actionMap.createAction("upgrade",!0),this._actionMap.createAction("sell",!0),this._actionMap.createAction("wave",!0),this._actionMap.createAction("clear"),this._actionMap.createAction("setTower"),this._actionMap.createAction("exit")}},{key:"initParticleEffects",value:function(){this.particleManager.addEffectManager}},{key:"createSpawner",value:function(t,e){var n=this.ecs.createEntity();return this.ecs.addComponent(n,v,{position:t}),this.ecs.addComponent(n,oe,{limit:0,rate:1,count:1}),this.ecs.addComponent(n,y),this.ecs.addComponent(n,Tt,{source:this.arrow,size:e?p.ONES:p.ZERO,rotationOffset:e?0:90}),n}},{key:"preStart",value:function(){this.entityMap.clear(),this.running=!0,this.ecs.clear(),this.money=30,this.lives=20,this.score=0,Mn()&&this.audioLoop.play(),this.first=!1,function(t,e){en(t,new p(5,15),new p(5,15)),tn(t,new p(5,1),"Tower Defense","#ffffff",2),tn(t,new p(2.5,2),(function(){return"Lives: "+e.lives.toFixed(0)}),"#ffffff"),tn(t,new p(7.5,2),(function(){return"Money: "+e.money.toFixed(0)}),"#ffffff"),tn(t,new p(5,4),"Towers","#ffffff");var n=en(t,new p(2,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-1"})}));t.addComponent(n,fe,{text:"1",style:"#ffffff"});var r=en(t,new p(4,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-2"})}));t.addComponent(r,fe,{text:"2",style:"#ffffff"});var i=en(t,new p(6,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-3"})}));t.addComponent(i,fe,{text:"3",style:"#ffffff"});var o=en(t,new p(8,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-4"})}));t.addComponent(o,fe,{text:"4",style:"#ffffff"}),tn(t,new p(5,7),"Selected","#ffffff"),tn(t,new p(1,8),(function(){var t=e.getSelection();if(null!==t){var n="";if("name"in t.data&&(n+=t.data.name.name+"\n"),"health"in t.data&&(n+="Health: "+t.data.health.health.toFixed(0)+"\n"),"value"in t.data&&(n+="Value: "+t.data.value.value.toFixed(0)+"\n"),"weapon"in t.data){var r=t.data.weapon;n+="Ready to Fire: "+r.canFire+"\n",n+="Fire Rate: "+(1/r.rate).toFixed(2)+" per second\n",n+="Damage: "+r.projectileType.damage.toFixed(2)+"\n",n+="Can Target: "+r.tags.join(", ")+"\n"}return"upgrade"in t.data&&t.data.upgrade.cost>0&&(n+="Upgrade cost: "+t.data.upgrade.cost.toFixed(0)+"\n"),n}return""}),"#ffffff",1,"left");var a=en(t,new p(2.675,24),new p(2.125,1),!0,(function(){return e.actionMap.invoke("sell")}));t.addComponent(a,fe,{text:"Sell",style:"#ffffff"});var s=en(t,new p(7.375,24),new p(2.125,1),!0,(function(){return e.actionMap.invoke("upgrade")}));t.addComponent(s,fe,{text:"Upgrade",style:"#ffffff"});var u=en(t,new p(5,26.5),new p(4.5,1),!0,(function(){return e.actionMap.invoke("wave")}));t.addComponent(u,fe,{text:"Send Next Wave",style:"#ffffff"});var c=en(t,new p(5,29),new p(4.5,1),!0,(function(){return e.actionMap.invoke("exit")}));t.addComponent(c,fe,{text:"Exit",style:"#ffffff"})}(this.ecs,this),this.northSouthPath=this.getPath().findNorthSouth(new Set),this.eastWestPath=this.getPath().findEastWest(new Set),this.northSpawnerID=this.createSpawner(new p(25,0),!1),this.eastSpawnerID=this.createSpawner(new p(10,15),!0);for(var t=0;t<30;t++)for(var e=10;e<40;e++){var n=this.ecs.createEntity();this.ecs.addComponent(n,v,{position:new p(e,t)}),this.ecs.addComponent(n,y),this.ecs.addComponent(n,zt,{source:this.floorTile})}for(var r=10;r<40;r++)r>=23&&r<=27||(this.createBlocker(new p(r,0)),this.createBlocker(new p(r,29)));for(var i=1;i<29;i++)i>=13&&i<=17||(this.createBlocker(new p(10,i)),this.createBlocker(new p(39,i)))}},{key:"addSystems",value:function(){this.ecs.createSystem(new Ae,-1),this.ecs.createSystem(new Oe(this.virtualCanvas),47),this.ecs.createSystem(new We),this.ecs.createSystem(new Xe)}},{key:"handleClick",value:function(t){null!==this.activeTower&&t.leftDown&&this.buildTower(t.coordinate,this.activeTower)}},{key:"clearMouseMode",value:function(){null!==this.mouseEntity&&(this.setSelection(-1),this.ecs.removeEntity(this.mouseEntity.id),this.mouseEntity=null,this.activeTower=null)}},{key:"setMouseMode",value:function(t,e){console.log("Setting mouse mode");var n=e.tower;this.activeTower=n,null!==this.mouseEntity&&this.clearMouseMode();var r=this.towerManager.createDemoTower(this.getMousePosition,n);this.mouseEntity=this.ecs.getEntity(r),this.setSelection(r)}},{key:"attemptSell",value:function(){var t=this.getSelection();if(null!==t&&this.ecs.hasComponent(t.id,ke)){var e=t.data.value.value;this.ecs.emitEvent("sellable:sell",t,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pn(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.data)),this.money+=W(e),this.ecs.removeEntity(t.id),this.invalidateSelection()}}},{key:"attemptUpgrade",value:function(){console.log("Attempting upgrade...");var t=this.getSelection();if(null!==t)if(this.ecs.hasComponent(t,nn)){var e=t;console.log(t.data.upgrade);var n=W(t.data.upgrade.cost);n>this.money?console.log("Not enough money"):(console.log("Upgrade done"),this.money-=n,e.data=(0,l.merge)(e.data,t.data.upgrade.dataDelta))}else console.log("Cannot be upgraded.");else console.log("Selection is null")}},{key:"buildTower",value:function(t,e){this.towerManager.canPlace(W(t),e)&&(this.towerManager.createTower(W(t),e),this.money-=this.towerManager.getTower(e).cost,Mn()&&this.buildSound.play())}},{key:"createBlocker",value:function(t){var e=this.ecs.createEntity();this.ecs.addComponent(e,v,{position:t.floor()}),this.ecs.addComponent(e,y),this.ecs.addComponent(e,Tt,{source:new q("assets/blocker.png")}),this.ecs.addComponent(e,dt,{size:1})}},{key:"actionMap",get:function(){return this._actionMap.asImmutable()}},{key:"getMap",value:function(){return this.entityMap}},{key:"getVirtualSize",value:function(){return this.virtualSize}},{key:"setNorthSouthPath",value:function(t){this.northSouthPath=t}},{key:"setEastWestPath",value:function(t){this.eastWestPath=t}},{key:"_getEastWestPath",value:function(){return this.eastWestPath}},{key:"_getNorthSouthPath",value:function(){return this.northSouthPath}},{key:"getPath",value:function(){return this.pathChecker}}]),h}(me)}}]);
//# sourceMappingURL=440.js.map