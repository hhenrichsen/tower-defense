(self.webpackChunkgamelib=self.webpackChunkgamelib||[]).push([[440],{440:(t,e,n)=>{"use strict";n.r(e),n.d(e,{GameModel:()=>An});var r=n(156),i=n(610),a=n(991),o=n(349),s=n(255),u=n(70),c=n(608),l=n(486),f=function(){function t(){(0,i.Z)(this,t)}return(0,a.Z)(t,[{key:"defaultData",value:function(){return{}}},{key:"init",value:function(t){return Object.assign(this.defaultData(),t||{})}}]),t}(),h=n(484),d=function(){function t(e,n){(0,i.Z)(this,t),this._x=0,this._y=0,this._x=e,this._y=n}return(0,a.Z)(t,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"squareMagnitude",value:function(){return Math.pow(this.x,2)+Math.pow(this.y,2)}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"normalize",value:function(){var e=this.magnitude();return 0==e?t.ZERO:new t(this.x/e,this.y/e)}},{key:"piecewiseScale",value:function(e){return new t(this.x*e.x,this.y*e.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"addConstant",value:function(e,n){return new t(this.x+e,this.y+n)}},{key:"floor",value:function(){return new t(Math.floor(this.x),Math.floor(this.y))}},{key:"ceil",value:function(){return new t(Math.ceil(this.x),Math.ceil(this.y))}},{key:"addScaled",value:function(e,n){return new t(this.x+e.x*n,this.y+e.y*n)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"subtractScaled",value:function(e,n){return new t(this.x-e.x*n,this.y-e.y*n)}},{key:"rotate",value:function(e){var n=e*Math.PI/180;return new t(this.x*Math.cos(n)-Math.sin(n)*this.y,this.x*Math.sin(n)+this.y*Math.cos(n))}},{key:"toAngle",value:function(){return Math.atan2(this.y,this.x)*(180/Math.PI)}},{key:"determinant",value:function(t){return this.x*t.y-this.y*t.x}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y)}},{key:"equals",value:function(t){return void 0!==t&&"object"===(0,h.Z)(t)&&Object.prototype.hasOwnProperty.call(t,"_x")&&Object.prototype.hasOwnProperty.call(t,"_y")&&t.x===this.x&&t.y===this.y}},{key:"hashCode",value:function(){return 31*this.x+this.y}}],[{key:"random",value:function(){return new t(Math.random(),Math.random()).normalize()}},{key:"fromAngle",value:function(e,n){return new t(Math.cos(e*(Math.PI/180))*(n||1),Math.sin(e*(Math.PI/180))*(n||1))}},{key:"matching",value:function(e){return new t(e,e)}},{key:"distance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}},{key:"squareDistance",value:function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}}]),t}();d.ZERO=new d(0,0),d.ONES=new d(1,1);const p=d;var v=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{position:p.ZERO}}}]),o}(f));var y=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{rotation:0}}}]),o}(f)),m=n(329);function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var w=function(){function t(e){(0,i.Z)(this,t),this._name=void 0,this.handlers=[],this._name=e}return(0,a.Z)(t,[{key:"addHandler",value:function(t){this.handlers.push(t)}},{key:"invoke",value:function(t){for(var e=0;e<this.handlers.length;e++)this.handlers[e](this,t)}},{key:"clear",value:function(){this.handlers=[]}},{key:"name",get:function(){return this._name}}]),t}(),Z=function(){function t(){(0,i.Z)(this,t),this.actions=void 0,this.serializeActions=void 0,this.actions=new Map,this.serializeActions=[]}return(0,a.Z)(t,[{key:"createAction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new w(t);this.actions.set(t,n),e&&this.serializeActions.push(t)}},{key:"addHandler",value:function(t,e){this.actions.has(t)?this.actions.get(t).addHandler(e):console.warn("Trying to add a handler on a nonexistent action.")}},{key:"invoke",value:function(t,e){this.actions.has(t)&&this.actions.get(t).invoke(e)}},{key:"clear",value:function(){this.actions.clear()}},{key:"clearListeners",value:function(){var t,e=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(this.actions);try{for(e.s();!(t=e.n()).done;)t.value[1].clear()}catch(t){e.e(t)}finally{e.f()}}},{key:"serialize",value:function(){return(0,m.Z)(this.serializeActions)}},{key:"asImmutable",value:function(){return this}}]),t}();var k,R=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{range:1}}}]),o}(f));function C(t){return function(e){(0,s.Z)(f,e);var n,r,o=(n=f,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,u.Z)(this,t)});function f(){return(0,i.Z)(this,f),o.apply(this,arguments)}return(0,a.Z)(f,[{key:"getName",value:function(){return(0,l.lowerFirst)(t.name)}}]),f}(t)}const x=new(C(k=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return a}(f))||k);var S=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{range:1,strokeStyle:"#ff0000ff",fillStyle:"#ffffff00",lineWidth:0,offset:p.ZERO}}}]),o}(f)),E=function t(e,n){(0,i.Z)(this,t),this.id=void 0,this.data=void 0,this.active=!0,this.id=e,this.data=n||{}};function b(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var B=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;(0,i.Z)(this,t),this.nextId=0,this.entities=void 0,this.entityComponents=void 0,this.systems=void 0,this.interestedSystems=void 0,this.allSystems=void 0,this.systemOrder=void 0,this.availableIDs=void 0,this.events=void 0,this.listeners=void 0,this.entities=new Map,this.systems=new Map,this.entityComponents=new Map,this.allSystems=new Set,this.systemOrder=[],this.update=this.update.bind(this),this.getEntityIDsWithComponent=this.getEntityIDsWithComponent.bind(this),this.getEntitiesWithComponent=this.getEntitiesWithComponent.bind(this),this.interestedSystems=new Map,this.availableIDs=[],this.events=[],this.listeners=new Map;for(var n=0;n<e;n++)this.createEntity({},!1),this.removeEntity(n)}return(0,a.Z)(t,[{key:"createEntity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.availableIDs.length>0&&e){var n=this.availableIDs.splice(0,1)[0],r=this.entities.get(n);return r.data=t||{},r.active=!0,this.emitEvent("ecs:create",r),n}var i=this.nextId++,a=new E(i,t);return this.entities.set(i,a),this.emitEvent("ecs:create",a),i}},{key:"listenEvent",value:function(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}},{key:"emitEvent",value:function(t,e,n){this.events.push({event:t,entity:e,extra:n})}},{key:"resolveId",value:function(t){return"number"==typeof t||"bigint"==typeof t?t>=this.nextId||!this.entities.has(t)?(console.warn("Cannot resolve entity ".concat(t,"; it does not exist.")),-1):t:t.id}},{key:"resolveEntity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("number"==typeof t||"bigint"==typeof t){var n=t;if(n>=this.nextId||!this.entities.has(n))return e||console.warn("Cannot resolve entity ".concat(t,"; it does not exist.")),null;var r=this.entities.get(t);return r.active?r:(e||console.warn("Cannot resolve entity ".concat(t,"; it has been deleted.")),null)}return t}},{key:"createSystem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.systems.has(e)||(this.systems.set(e,new Set),this.systemOrder.push(e),this.systemOrder.sort()),this.systems.get(e).add(t),this.allSystems.add(t);var n=t.getBasisComponent();null!==n&&(this.interestedSystems.has(n.getName())||this.interestedSystems.set(n.getName(),new Set),this.interestedSystems.get(n.getName()).add(t)),t.setManager(this)}},{key:"removeSystem",value:function(t){this.allSystems.delete(t),this.systems.forEach((function(e){e.has(t)&&e.delete(t)}))}},{key:"hasComponent",value:function(t,e){var n=this.resolveEntity(t);return null!=n&&e.getName()in n.data}},{key:"addComponent",value:function(t,e,n){var r=this.resolveEntity(t);if(null!==r){if(r.data[e.getName()]=e.init(n),void 0!==this.interestedSystems.get(e.getName())){var i,a=b(this.interestedSystems.get(e.getName()));try{for(a.s();!(i=a.n()).done;)i.value.notify(e.getName(),r)}catch(t){a.e(t)}finally{a.f()}}this.emitEvent("ecs:addComponent",r,{component:e}),this.entityComponents.has(e.getName())||this.entityComponents.set(e.getName(),new Set),this.entityComponents.get(e.getName()).add(r.id)}}},{key:"getEntity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.resolveEntity(t,e)}},{key:"getEntityIDsWithComponent",value:function(t){var e=t.getName();if(this.entityComponents.has(e)){var n,r=[],i=b(this.entityComponents.get(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=this.resolveEntity(a,!0);null!==o&&o.active&&r.push(a)}}catch(t){i.e(t)}finally{i.f()}return r}return[]}},{key:"getEntitiesWithComponent",value:function(t){var e=t.getName();if(this.entityComponents.has(e)){var n,r=[],i=b(this.entityComponents.get(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=this.resolveEntity(a,!0);null!==o&&o.active&&void 0!==o.data[e]&&r.push(o)}}catch(t){i.e(t)}finally{i.f()}return r}return[]}},{key:"removeComponent",value:function(t,e){var n=this.resolveEntity(t);if(null!==n&&(e.getName()in n.data&&delete n.data[e.getName()],this.entityComponents.has(e.getName())||this.entityComponents.set(e.getName(),new Set),this.emitEvent("ecs:removeComponent",n,{component:e}),this.entityComponents.get(e.getName()).delete(n.id),this.interestedSystems.has(e.getName()))){var r,i=b(this.interestedSystems.get(e.getName()));try{for(i.s();!(r=i.n()).done;)r.value.notify("__delete",this.entities.get(n.id))}catch(t){i.e(t)}finally{i.f()}}}},{key:"update",value:function(t,e){for(var n=0;n<this.events.length;n++){var r=this.events[n].event;if(this.listeners.has(r))for(var i=this.listeners.get(r),a=0;a<i.length;a++)i[a](this.events[n])}this.events.length=0;for(var o=0;o<this.systemOrder.length;o++){var s,u=this.systemOrder[o],c=b(this.systems.get(u));try{for(c.s();!(s=c.n()).done;)s.value.update(t,e)}catch(t){c.e(t)}finally{c.f()}}}},{key:"removeEntity",value:function(t){var e=this.resolveEntity(t);if(null!==e){var n,r=b(this.allSystems);try{for(r.s();!(n=r.n()).done;)n.value.notify("__delete",this.entities.get(e.id))}catch(t){r.e(t)}finally{r.f()}this.emitEvent("ecs:delete",e),e.data={},e.active=!1,this.availableIDs.push(e.id)}}},{key:"clear",value:function(){var t,e=b(this.allSystems);try{for(e.s();!(t=e.n()).done;)t.value.notify("__clear",null)}catch(t){e.e(t)}finally{e.f()}var n,r=b(this.entities.keys());try{for(r.s();!(n=r.n()).done;){var i=n.value;this.entities.delete(i)}}catch(t){r.e(t)}finally{r.f()}this.availableIDs=[],this.nextId=0}}]),t}();new B;var M=function(){function t(){(0,i.Z)(this,t),this.listeners=[],this.events=[],this.keyListeners=new Map,this.keyPushed=new Map,this.keyDown=this.keyDown.bind(this),this.keyUp=this.keyUp.bind(this)}return(0,a.Z)(t,[{key:"install",value:function(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp)}},{key:"keyDown",value:function(t){this.events.push({key:t.key,down:!0})}},{key:"keyUp",value:function(t){this.events.push({key:t.key,down:!1})}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"addKeyListener",value:function(t,e){this.keyListeners.has(t.toLowerCase())||this.keyListeners.set(t.toLowerCase(),[]),this.keyListeners.get(t.toLowerCase()).push(e)}},{key:"clearListeners",value:function(){this.keyListeners.clear(),this.listeners=[]}},{key:"update",value:function(){for(var t=0;t<this.events.length;t++){var e=this.events[t],n=e.key.toLowerCase();if(this.keyPushed.get(n)!==e.down){if(this.keyPushed.set(n,e.down),this.keyListeners.has(n))for(var r=this.keyListeners.get(n),i=0;i<r.length;i++)r[i](e);for(var a=0;a<this.listeners.length;a++)this.listeners[a](e)}}this.events.length=0}},{key:"uninstall",value:function(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp)}}]),t}(),T=function t(){(0,i.Z)(this,t),this.isLeftMouseDown=!1,this.isRightMouseDown=!1,this.mouseCoordinate=p.ZERO},P=function(){function t(){(0,i.Z)(this,t),this.mouse=new T,this.listeners=[],this.events=[],this.getMousePosition=this.getMousePosition.bind(this)}return(0,a.Z)(t,[{key:"install",value:function(t,e){var n=this;t.addEventListener("mousemove",(function(t){var r=e.getCoordinates(),i=e.getOffset();n.mouse.mouseCoordinate=r.inverseTranslate(new p(t.x,t.y).subtract(i))})),t.addEventListener("mousedown",(function(t){n.mouse.isLeftMouseDown=!0,n.events.push({coordinate:n.mouse.mouseCoordinate,leftDown:!0})})),t.addEventListener("mouseup",(function(t){n.mouse.isLeftMouseDown=!1,n.events.push({coordinate:n.mouse.mouseCoordinate,leftDown:!1})}))}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"update",value:function(){for(var t=0;t<this.events.length;t++)for(var e=this.events[t],n=0;n<this.listeners.length;n++)this.listeners[n](e);this.events.length=0}},{key:"getMousePosition",value:function(){return this.mouse.mouseCoordinate}}]),t}(),D=function(){function t(e,n){(0,i.Z)(this,t),this.scaleX=void 0,this.scaleY=void 0,this.scaleX=e,this.scaleY=n,this.translate=this.translate.bind(this),this.translateValueX=this.translateValueX.bind(this),this.translateValueY=this.translateValueY.bind(this)}return(0,a.Z)(t,[{key:"translate",value:function(t){return new p(t.x*this.scaleX,t.y*this.scaleY)}},{key:"inverseTranslate",value:function(t){return new p(t.x/this.scaleX,t.y/this.scaleY)}},{key:"translateValueX",value:function(t){return t*this.scaleX}},{key:"translateValueY",value:function(t){return t*this.scaleY}}]),t}(),A=function(){function t(e){(0,i.Z)(this,t),this.canvas=void 0,this.context=void 0,this.virtualSize=void 0,this.aspectRatio=void 0,this.offset=p.matching(.5),this.vcs=void 0,this.installed=!1,this.parent=void 0,this.virtualSize=e,this.aspectRatio=e.normalize()}return(0,a.Z)(t,[{key:"install",value:function(t){var e=document.createElement("canvas");this.canvas=e,this.initCanvas(),t.appendChild(e),this.parent=t,this.installed=!0,this.resize()}},{key:"initCanvas",value:function(){var t=this.canvas;this.context=this.canvas.getContext("2d"),t.width=this.virtualSize.x,t.height=this.virtualSize.y,t.id="canvas",window.addEventListener("resize",this.resize.bind(this))}},{key:"drawGrid",value:function(){for(var t=0;t<this.virtualSize.x;t++)this.line(new p(t,0),new p(t,this.virtualSize.y),"#000000ff");for(var e=0;e<this.virtualSize.y;e++)this.line(new p(0,e),new p(this.virtualSize.x,e),"#000000ff")}},{key:"findCanvas",value:function(){var t=document.getElementById("canvas");"canvas"!==t.nodeName.toLowerCase()?console.error("Cannot find valid canvas, found ".concat(t.nodeName," instead.")):(this.canvas=t,this.initCanvas())}},{key:"uninstall",value:function(){this.installed=!1,this.parent.removeEventListener("resize",this.resize)}},{key:"drawWorldText",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Montserrat",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"center",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500,s=t.trim().split("\n");this.context.fillStyle=n||"#ffffff",this.context.font="".concat(o," ").concat(r*this.vcs.translateValueY(.5),"px ").concat(i),this.context.textAlign=a;for(var u=0;u<s.length;u++){var c=this.vcs.translate(e.addConstant(.5,u+.5));this.context.fillText(s[u],c.x,c.y)}}},{key:"drawText",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Montserrat",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"center",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500,s=t.trim().split("\n");this.context.fillStyle=n||"#ffffff",this.context.font="".concat(o," ").concat(r*this.vcs.translateValueY(.5),"px ").concat(i),this.context.textAlign=a;for(var u=0;u<s.length;u++){var c=this.vcs.translate(e.addConstant(0,u));this.context.fillText(s[u],c.x,c.y)}}},{key:"drawImage",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(t&&t.ready){this.context.globalAlpha=i;var a=this.vcs.translate(e.add(this.offset)),o=this.vcs.translate(n);this.context.save(),this.context.translate(a.x,a.y),this.context.rotate(r*Math.PI/180),this.context.translate(-a.x,-a.y),this.context.drawImage(t.texture,a.x-o.x/2,a.y-o.y/2,o.x,o.y),this.context.restore(),this.context.globalAlpha=1}}},{key:"drawCircle",value:function(t,e,n,r,i){var a=this.vcs.translate(t.add(this.offset)),o=this.vcs.translateValueX(e);this.context.fillStyle=n||"#ffffff00",this.context.beginPath(),this.context.arc(a.x,a.y,o,0,2*Math.PI),this.context.fill(),this.context.strokeStyle=r||"#ff0000",this.context.lineWidth=this.vcs.translateValueX(i)||1,this.context.arc(a.x,a.y,o,0,2*Math.PI),this.context.stroke()}},{key:"drawImageAnimated",value:function(t,e,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(t.ready){this.context.globalAlpha=o;var s=this.vcs.translate(e.add(this.offset)),u=this.vcs.translate(r);this.context.save(),this.context.translate(s.x,s.y),this.context.rotate(n*Math.PI/180),this.context.translate(-s.x,-s.y),this.context.drawImage(t.texture,i.x*a,0,i.x,i.y,s.x-u.x/2,s.y-u.y/2,u.x,u.y),this.context.restore(),this.context.globalAlpha=1}}},{key:"drawWorldRectangle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff00",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff00",i=this.vcs.translate(t.addConstant(.5,.5)),a=this.vcs.translate(e.addConstant(.5,.5));this.context.fillStyle=n||"#ff0000",this.context.fillRect(i.x,i.y,a.x-i.x,a.y-i.y),this.context.strokeStyle=r||"#ff0000",this.context.strokeRect(i.x,i.y,a.x-i.x,a.y-i.y)}},{key:"drawRectangle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff00",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff00",i=this.vcs.translate(t),a=this.vcs.translate(e);this.context.fillStyle=n||"#ff0000",this.context.fillRect(i.x,i.y,a.x-i.x,a.y-i.y),this.context.strokeStyle=r||"#ff0000",this.context.strokeRect(i.x,i.y,a.x-i.x,a.y-i.y)}},{key:"line",value:function(t,e,n){var r=this.vcs.translate(t),i=this.vcs.translate(e);this.beginPath(),this.strokeStyle=n||"#ff0000",this.context.lineTo(r.x,r.y),this.context.lineTo(i.x,i.y),this.stroke()}},{key:"beginPath",value:function(){this.context.beginPath()}},{key:"strokeStyle",set:function(t){this.context.strokeStyle=t}},{key:"stroke",value:function(){this.context.stroke()}},{key:"translate",value:function(t){var e=this.vcs.translate(t);this.context.translate(e.x,e.y)}},{key:"clear",value:function(){this.context.clearRect(0,0,this.vcs.translateValueX(this.virtualSize.x),this.vcs.translateValueY(this.virtualSize.y))}},{key:"getCoordinates",value:function(){return this.vcs}},{key:"getOffset",value:function(){var t=this.canvas.getBoundingClientRect();return new p(t.x,t.y)}},{key:"resize",value:function(){this.parent.clientWidth/this.aspectRatio.x<this.parent.clientHeight/this.aspectRatio.y?(this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientWidth*this.aspectRatio.y/this.aspectRatio.x):(this.canvas.width=this.parent.clientHeight*this.aspectRatio.x/this.aspectRatio.y,this.canvas.height=this.parent.clientHeight),this.vcs=new D(this.canvas.width/this.virtualSize.x,this.canvas.height/this.virtualSize.y)}}]),t}();var N=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{action:function(){}}}}]),o}(f));var j=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{delta:p.ZERO,offset:p.ZERO,thisClick:!1}}}]),o}(f));function z(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return F(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var I=function(){function t(){(0,i.Z)(this,t),this.entities=new Map,this.manager=void 0}return(0,a.Z)(t,[{key:"checkInterval",value:function(t,e){return!(t<0||e.rate<=0||e.elapsed<0||(e.elapsed+=t,!(e.elapsed>=e.rate)||(e.elapsed-=e.rate,0)))}},{key:"notify",value:function(t,e,n){if("__clear"===t)this.entities.clear();else if("__delete"===t)this.entities.delete(e.id);else if("__remove_component"===t){var r=n.componentName;this.getBasisComponent().getName()===r&&this.entities.delete(e.id)}else this.checkBasis(t,e)&&this.isInterested(t,e)&&this.entities.set(e.id,e)}},{key:"onManagerAwake",value:function(){}},{key:"setManager",value:function(t){this.manager=t,this.onManagerAwake()}},{key:"checkBasis",value:function(t,e){var n=this.getRequiredComponents(),r=this.getExcludedComponents();return this.checkRequired(t,e,n)&&this.checkExcluded(t,e,r)}},{key:"checkRequired",value:function(t,e,n){var r,i=z(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!(a.getName()in e.data))return console.warn("Could not find required component ".concat(a.getName()," while adding ").concat(t,"; this is a required component and ").concat(t," will not trigger related systems' interest.")),!1}}catch(t){i.e(t)}finally{i.f()}return!0}},{key:"checkExcluded",value:function(t,e,n){var r,i=z(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.getName()in e.data)return console.warn("Found excluded component ".concat(a.getName()," while adding ").concat(t,"; this is an excluded component and ").concat(t," will not trigger related systems' interest.")),!1}}catch(t){i.e(t)}finally{i.f()}return!0}},{key:"update",value:function(t,e){this.systemUpdate(t,e);var n,r=z(this.entities.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;this.updateEntity(t,i,e)}}catch(t){r.e(t)}finally{r.f()}}},{key:"systemUpdate",value:function(t,e){}},{key:"listener",value:function(t){var e=t.event,n=t.entity,r=t.extra;this.entities.has(n.id)&&this.onEvent(e,n,r)}},{key:"listenerNoCheck",value:function(t){var e=t.event,n=t.entity,r=t.extra;this.onEvent(e,n,r)}},{key:"listen",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.manager.listenEvent(t,this.listener.bind(this)):this.manager.listenEvent(t,this.listenerNoCheck.bind(this))}},{key:"onEvent",value:function(t,e,n){}},{key:"getBasisComponent",value:function(){return null}},{key:"getRequiredComponents",value:function(){return new Set}},{key:"getExcludedComponents",value:function(){return new Set}},{key:"isInterested",value:function(t,e){return!0}},{key:"updateEntity",value:function(t,e,n){}}]),t}();var _=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){e.data.abstractClick.action(e,this.manager)}},{key:"getBasisComponent",value:function(){return N}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(j),t}}]),o}(I);var L=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{acceleration:p.ZERO}}}]),o}(f));function W(t){return"function"==typeof t?t():t}var U=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{velocity:p.ZERO}}}]),o}(f));var q=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.velocity,i=n.acceleration;r.velocity=W(r.velocity).addScaled(W(i.acceleration),t)}},{key:"getBasisComponent",value:function(){return L}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(U),t}}]),o}(I),H=function(){function t(e,n){var r=this;(0,i.Z)(this,t),this.size=void 0,this.el=void 0,this.ready=!1,this.el=new Image,this.el.src=e,this.el.addEventListener("load",(function(t){r.ready=!0,n||(r.size=new p(r.el.naturalWidth,r.el.naturalHeight))}))}return(0,a.Z)(t,[{key:"texture",get:function(){return this.el}}]),t}();var G=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{size:d.ONES,frameSize:d.matching(32),source:o.NoTex,frames:[1,1],frame:0,currentDuration:0,opacity:1}}}]),o}(f);G.NoTex=new H("assets/notex-anim.png",new d(64,32));const X=new G;var V=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.animatedSprite,i=n.rotation,a=n.position;for(r.currentDuration+=t;r.currentDuration>r.frames[r.frame];)r.currentDuration-=r.frames[r.frame],r.frame=(r.frame+1)%r.frames.length;this.virtualCanvas.drawImageAnimated(r.source,W(a.position),W(i.rotation),r.size,r.frameSize,r.frame,W(r.opacity))}},{key:"getBasisComponent",value:function(){return X}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(y),t}}]),o}(I);var Y=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{background:"#77777755",backgroundHover:"#aaaaaa55"}}}]),o}(f));var $=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t,e){var n;return(0,i.Z)(this,o),(n=r.call(this)).mouse=void 0,n.virtualCanvas=void 0,n.mouse=t,n.virtualCanvas=e,n}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=W(this.mouse),r=e.data,i=r.position,a=r.clickable,o=r.clickableDisplay,s=W(a.delta),u=W(i.position),c=u.subtract(s),l=u.add(s);n.x>c.x&&n.y>c.y&&n.x<l.x&&(n.y,l.y),this.virtualCanvas.drawRectangle(c,l,W(o.backgroundHover))}},{key:"getBasisComponent",value:function(){return Y}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I),K=n(699);function J(t,e){return Q(t.center,t.radius,e)}function Q(t,e,n){return p.distance(t,n)<=e}function tt(t,e,n,r){return t.x<=r.x&&e.x>=n.x&&t.y<=r.y&&e.x>=n.y}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var nt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).mouse=void 0,e.runCheck=void 0,e.mouse=t,e.runCheck=!1,e}return(0,a.Z)(o,[{key:"update",value:function(t,e){if("click"===e.getMouseAction()){var n,r=this.entities,i=void 0,a=void 0,o=void 0,s=W(this.mouse),u=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return et(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(r.values());try{for(u.s();!(n=u.n()).done;){var c=n.value,l=c.data,f=l.position,h=l.clickable,d=s.add(W(h.offset)),p=this.offsetDelta(W(f.position),W(h.delta)),v=(0,K.Z)(p,2),y=v[0],m=v[1];g=y,w=m,(Z=d).x>=g.x&&Z.x<=w.x&&Z.y>=g.y&&Z.y<=w.y&&(void 0!==i?tt(y,m,a,o)&&c.id>i.id&&(i=c):(i=c,a=y,o=m))}}catch(t){u.e(t)}finally{u.f()}void 0!==i&&this.manager.emitEvent("click",i)}var g,w,Z}},{key:"updateEntity",value:function(){}},{key:"offsetDelta",value:function(t,e){return[t.subtract(e),t.add(e)]}},{key:"getBasisComponent",value:function(){return j}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var rt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{component:x,data:{}}}}]),o}(f));var it=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){var n=e.data.clickComponentAdd;this.manager.addComponent(e.id,W(n.component),W(n.data))}},{key:"getBasisComponent",value:function(){return rt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var at=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{components:[],data:[]}}}]),o}(f));var ot=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){for(var n=e,r=n.data.clickComponentToggleMultiple,i=W(r.components),a=W(r.data),o=0;o<i.length;o++){var s=i[o];this.manager.hasComponent(n.id,s)?this.manager.removeComponent(n.id,s):this.manager.addComponent(n.id,s,a[o])}}},{key:"getBasisComponent",value:function(){return at}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(j),t}}]),o}(I);var st=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{component:x,data:{}}}}]),o}(f));var ut=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){var n=e,r=n.data.clickComponentToggle,i=W(r.component);this.manager.hasComponent(n.id,i)?this.manager.removeComponent(n.id,i):this.manager.addComponent(n.id,i,W(r.data))}},{key:"getBasisComponent",value:function(){return st}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(j),t}}]),o}(I);var ct=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{data:{}}}}]),o}(f));var lt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("click")}},{key:"onEvent",value:function(t,e){var n=e,r=n.data.clickDataMutate;n.data=(0,l.merge)(n.data,W(r.data))}},{key:"getBasisComponent",value:function(){return ct}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(j),t}}]),o}(I);var ft=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{dragging:!1,offset:p.ZERO}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),o}(f));var ht=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).source=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.draggable,i=n.position;r.dragging&&(i.position=this.source().add(W(r.offset)))}},{key:"getBasisComponent",value:function(){return ft}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var dt,pt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{size:1,tracked:!1}}}]),o}(f)),vt=function(t){return function(e){e.prototype.getBasisComponent=function(){return t}}},yt=function(t){return function(e){for(var n=new Set,r=0;r<t.length;r++)n.add(t[r]);e.prototype.getRequiredComponents=function(){return n}}};var mt,gt=vt(pt)(dt=yt([v])(dt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).map=void 0,e.map=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.footprint;if(!i.tracked){i.tracked=!0;for(var a=W(r.position).floor(),o=Math.floor((i.size-1)/2),s=new p(a.x-o,a.y-o),u=Math.floor(i.size/2),c=new p(a.x+u,a.y+u),l=s.x;l<=c.x;l++)for(var f=s.y;f<=c.y;f++)this.map.createEntityLink(new p(l,f),e)}}}]),o}(I))||dt)||dt;var wt=new(C(mt=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return a}(f))||mt);const Zt=wt;var kt,Rt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{health:10,maxHealth:10}}}]),o}(f));var Ct,xt=vt(wt)(kt=yt([v,Rt])(kt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.health,a=W(r.position),o=a.addConstant(-.5,-.5),s=a.addConstant(.5,-.4),u=i.health/i.maxHealth,c=a.addConstant(u-.5,-.4);this.virtualCanvas.drawWorldRectangle(o,s,"#ff000099","#00000099"),this.virtualCanvas.drawWorldRectangle(o,c,"#00ff0099","#00000099")}}]),o}(I))||kt)||kt;function St(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Et=vt(Rt)(Ct=function(t){(0,s.Z)(l,t);var e,n,o=(e=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function l(){return(0,i.Z)(this,l),o.apply(this,arguments)}return(0,a.Z)(l,[{key:"updateEntity",value:function(t,e){var n=e;n.data.health.health<=0&&(this.manager.emitEvent("health:die",n,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?St(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n.data)),this.manager.removeEntity(n))}}]),l}(I))||Ct;var bt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{lifetime:1,elapsed:0}}}]),o}(f));const Ot=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),o}(f));var Bt,Mt,Tt;const Pt=new(C((Tt=Mt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){var t;return(0,i.Z)(this,o),t=r.call(this),void 0===o.NO_TEXTURE&&(o.NO_TEXTURE=new H("assets/notex.png",p.matching(32))),t}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{source:o.NO_TEXTURE,size:o.DEFAULT_SIZE,opacity:1,offset:p.ZERO,rotationOffset:0}}}]),o}(f),Mt.NO_TEXTURE=void 0,Mt.DEFAULT_SIZE=p.ONES,Bt=Tt))||Bt);var Dt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.lifetime;n.sprite.opacity=(r.lifetime-r.elapsed)/r.lifetime}},{key:"getBasisComponent",value:function(){return Ot}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(Pt),t.add(bt),t}}]),o}(I);var At,Nt,jt,zt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data.lifetime;n.elapsed+=t,n.elapsed>=n.lifetime&&this.manager.removeEntity(e.id)}},{key:"getBasisComponent",value:function(){return bt}}]),o}(I);const Ft=new(C((jt=Nt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){var t;return(0,i.Z)(this,o),t=r.call(this),void 0===o.NO_TEXTURE&&(o.NO_TEXTURE=new H("assets/notex.png",p.matching(32))),t}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{source:o.NO_TEXTURE,size:o.DEFAULT_SIZE,offset:p.ZERO}}}]),o}(f),Nt.NO_TEXTURE=void 0,Nt.DEFAULT_SIZE=p.ONES,At=jt))||At);var It;var _t=vt(Ft)(It=yt([v,y])(It=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.lowSprite,i=n.position;this.virtualCanvas.drawImage(r.source,W(i.position).add(W(r.offset)),r.size)}}]),o}(I))||It)||It;var Lt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{radius:1,onSnap:function(){}}}}]),o}(f));const Wt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),o}(f));var Ut=function(){function t(e,n){(0,i.Z)(this,t),this._center=void 0,this._radius=void 0,this._center=e,this._radius=n}return(0,a.Z)(t,[{key:"center",get:function(){return this._center}},{key:"radius",get:function(){return this._radius}}]),t}();var qt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){for(var n=e,r=n.data,i=r.magnet,a=r.position,o=new Ut(W(a.position),W(i.radius)),s=this.manager.getEntitiesWithComponent(Wt),u=0;u<s.length;u++){var c=s[u];J(o,W(c.data.position.position))&&(c.data.position.position=n.data.position.position,i.onSnap(n,c,this.manager),this.manager.emitEvent("magnet:snap",c),this.manager.emitEvent("magnet:pull",c))}}},{key:"getBasisComponent",value:function(){return Lt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var Ht=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{path:[],point:0,invalidated:!1}}}]),o}(f));var Gt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{target:p.ZERO,velocity:3,strictness:.01}}}]),o}(f));var Xt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{target:p.ZERO,turnRate:180,strictness:.05}}}]),o}(f));var Vt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data,i=r.position,a=r.velocityTarget,o=r.rotationTarget,s=r.pathFollower,u=W(i.position),c=W(a.target),l=W(s.path);if(s.invalidated){0===l.length&&(a.target=u,s.point=0);for(var f=p.squareDistance(u,W(l[0])),h=0,d=1;d<l.length;d++){var v=W(l[d]),y=p.distance(u,v);y<f&&(f=y,h=d)}s.point=h+1,s.invalidated=!1}if(this.checkRelativeThreshold(c,W(i.position),a.strictness)&&s.point<l.length&&s.point++,s.point<l.length){var m=l[s.point];a.target=m,o.target=m}else this.manager.emitEvent("pathFollower:done",n)}},{key:"checkRelativeThreshold",value:function(t,e,n){return Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n}},{key:"getBasisComponent",value:function(){return Ht}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(Xt),t.add(Gt),t}}]),o}(I);const Yt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),o}(f));var $t=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=W(e.data.position.position);this.virtualCanvas.line(n.addConstant(-1,0),n.addConstant(1,0),"#ff0000"),this.virtualCanvas.line(n.addConstant(0,-1),n.addConstant(0,1),"#ff0000")}},{key:"getBasisComponent",value:function(){return Yt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var Kt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.position.position,i=n.data.range.range,a=n.data.rangeDisplay,o=a.strokeStyle,s=a.fillStyle,u=a.lineWidth,c=a.offset;this.virtualCanvas.drawCircle(W(r).add(W(c)),i,s,o,u>=1?u:void 0)}},{key:"getBasisComponent",value:function(){return S}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(R),t}}]),o}(I);var Jt=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{delta:p.ZERO,fillColor:"#555555",strokeColor:"#55555500"}}}]),o}(f));var Qt=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.position.position,i=n.data.region,a=W(i.delta),o=W(i.fillColor),s=W(i.strokeColor),u=W(r);this.virtualCanvas.drawRectangle(u.subtract(a),u.add(a),o,s)}},{key:"getBasisComponent",value:function(){return Jt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);const te=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),o}(f));var ee,ne=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.rotation.rotation,i=n.data.position.position,a=p.fromAngle(W(r)).scale(2),o=W(i).add(a);this.virtualCanvas.line(W(i),o,"#ff0000")}},{key:"getBasisComponent",value:function(){return te}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(y),t}}]),o}(I);var re=vt(Xt)(ee=yt([y,v])(ee=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data.position,i=n.data.rotationTarget,a=n.data.rotation;if(void 0!==i&&void 0!==W(i.target)){var o=W(i.target).subtract(W(r.position)),s=(W(a.rotation)%360+360)%360,u=p.fromAngle(s),c=(o.toAngle()+360)%360;i.targetRotation=c;var l=Math.sign(u.determinant(o)),f=Math.abs(s-c),h=Math.min(i.turnRate*t,f);a.rotation=((W(a.rotation)+h*l)%360+360)%360,Math.abs(f)<i.strictness&&this.manager.emitEvent("rotationTarget:reached",n)}}},{key:"checkRelativeThreshold",value:function(t,e,n){return Math.abs(t-e)<n||Math.abs(t+360-e)<n||Math.abs(t-(e+360))<n}}]),o}(I))||ee)||ee;var ie=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{range:1,strokeStyle:"#ff0000ff",fillStyle:"#ffffff00",lineWidth:0,offset:p.ZERO,radius:1}}}]),o}(f));var ae=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.selectionDisplay;this.virtualCanvas.drawCircle(W(r.position),W(i.radius),i.fillStyle,i.strokeStyle,i.lineWidth)}},{key:"getBasisComponent",value:function(){return ie}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);const oe=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{rate:1,elapsed:0,count:1,producer:function(){},limit:-1,total:0}}}]),o}(f));var se,ue=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){for(var n=e,r=n.data.spawner;this.checkInterval(t,r);)for(var i=0;i<r.count;i++)(r.limit<0||r.total<r.limit)&&(r.total++,r.producer(n,this.manager))}},{key:"getBasisComponent",value:function(){return oe}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var ce=vt(Pt)(se=yt([v,y])(se=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.sprite,i=n.rotation,a=n.position;this.virtualCanvas.drawImage(r.source,W(a.position).add(W(r.offset)),r.size,W(i.rotation)+W(r.rotationOffset),W(r.opacity))}}]),o}(I))||se)||se;var le=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{offset:p.ZERO,parent:null,child:null,index:0}}}]),o}(f));var fe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("stack:attach",!1),this.listen("stack:detach"),this.listen("stack:swap")}},{key:"onEvent",value:function(t,e,n){"stack:attach"===t&&this.handleAttach(e,n),"stack:detach"===t&&this.handleDetach(e),"stack:swap"===t&&this.handleSwap(e)}},{key:"handleAttach",value:function(t,e){var n=e.indexOffset||0,r=this.manager.getEntity(e.parent),i=r;if(null!=r){for(;null!==r&&null!==r.data.stack.child;)r=r.data.stack.child;if(null!==r)for(var a=0;a<n;a++)r=r.data.stack.parent;if(null!==r){var o=r.data,s=o.position,u=o.stack;"stack"in t.data||this.manager.addComponent(t,le,{offset:u.offset,index:u.index+1});var c=t.data,l=c.position,f=c.stack;l.position=W(s.position).add(W(u.offset)),f.parent=r,this.manager.emitEvent("stack:attached",t,{parent:r})}else null!==i&&this.manager.emitEvent("stack:attach",t,{parent:i})}}},{key:"handleSwap",value:function(t){var e=t,n=e.data.stack,r=n.parent;if(null!==r){var i=r.data.stack;n.parent=r.data.stack.parent,i.child=n.child,n.child=r,n.index--,i.index++,i.parent=e,null!==n.parent&&(n.parent.data.stack.child=e),null!==i.child&&(i.child.data.stack.parent=r)}}},{key:"handleDetach",value:function(t){if("stack"in t.data){var e=t.data.stack;if(null!==e.parent){var n=e.parent;e.parent=null,e.index=0,n.data.stack.child=null,this.manager.emitEvent("stack:detached",t,{oldParent:n})}}}},{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.stack;if(null!==i.parent){var a=i.parent.data.position;r.position=W(a.position).add(W(i.offset))}}},{key:"getBasisComponent",value:function(){return le}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);const he=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{text:"Sample text",style:"#000000ff",size:1,font:"Montserrat",align:"center"}}}]),o}(f));var de=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.textRender,i=n.position;this.virtualCanvas.drawText(W(r.text),W(i.position),r.style,r.size,r.font,r.align)}},{key:"getBasisComponent",value:function(){return he}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var pe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.position,i=n.velocity;r.position=W(r.position).addScaled(W(i.velocity),t)}},{key:"getBasisComponent",value:function(){return U}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t}}]),o}(I);var ve=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e,r=n.data,i=r.position,a=r.velocity,o=r.velocityTarget,s=W(o.target);if(void 0!==s){var u=s.subtract(W(i.position)).normalize().normalize().scale(o.velocity);if(this.checkRelativeThreshold(s,W(i.position),u.magnitude()*t))return this.manager.emitEvent("velocityTarget:reached",n),i.position=s,void(a.velocity=p.ZERO);this.checkRelativeThreshold(s,W(i.position),o.strictness)?a.velocity=p.ZERO:a.velocity=u}}},{key:"checkRelativeThreshold",value:function(t,e,n){return Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n}},{key:"getBasisComponent",value:function(){return Gt}},{key:"getRequiredComponents",value:function(){var t=new Set;return t.add(v),t.add(U),t}}]),o}(I);function ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var me=function(){function t(e,n,r){(0,i.Z)(this,t),this.positions=void 0,this.owners=void 0,this.entities=void 0,this.minimumBound=void 0,this.maximumBound=void 0,this.yScale=void 0,this.positions=new Map,this.owners=new Map,this.entities=new Set,this.minimumBound=e,this.maximumBound=n,this.yScale=this.maximumBound.x-this.minimumBound.x,r.listenEvent("ecs:delete",this.listener.bind(this))}return(0,a.Z)(t,[{key:"getCoordinate",value:function(t){var e=t.x-this.minimumBound.x;return(t.y-this.minimumBound.y)*(this.maximumBound.x-this.minimumBound.x)+e}},{key:"listener",value:function(t){var e=t.entity.id;if(this.owners.has(e)){var n,r=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ye(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(this.owners.get(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;this.positions.delete(i)}}catch(t){r.e(t)}finally{r.f()}this.owners.delete(e)}this.entities.delete(e)}},{key:"clear",value:function(){this.positions.clear()}},{key:"checkArea",value:function(t,e){for(var n=t.y;n<e.y;n++)for(var r=t.x;r<e.x;r++)if(this.hasEntityAt(new p(r,n)))return!1;return!0}},{key:"getEntityAt",value:function(t){var e=this.getCoordinate(t);return this.positions.has(e)?this.positions.get(e):null}},{key:"hasEntityAt",value:function(t){var e=this.getCoordinate(t);return this.positions.has(e)}},{key:"createEntityLink",value:function(t,e){if(this.hasEntityAt(t))console.warn("Overlapping entity at ".concat(t.toString()));else{var n=this.getCoordinate(t);this.positions.set(n,e),this.entities.add(e.id),this.owners.has(e.id)||this.owners.set(e.id,new Set),this.owners.get(e.id).add(n)}}},{key:"region",value:function(t,e,n){for(var r=t.y;r<e.y;r++)for(var i=t.x;i<e.x;i++){var a=t.addConstant(i,r);this.createEntityLink(a,n)}}},{key:"getNeighbors",value:function(t){for(var e=t.x,n=t.y,r=[],i=-1;i<=1;i++)for(var a=-1;a<=1;a++)if(!(e+i>this.maximumBound.x||e+i<this.minimumBound.x||n+a>this.maximumBound.y||n+a<this.minimumBound.y||0==e&&0==n)){var o=new p(e+i,n+a);this.hasEntityAt(o)&&r.push(this.getEntityAt(o))}return r}},{key:"isBlocked",value:function(t){return this.hasEntityAt(t)}}]),t}(),ge=function(){function t(e){(0,i.Z)(this,t),this.eventQueue=[],this.ecs=void 0,this.virtualCanvas=void 0,this.lastTime=void 0,this.entityMap=void 0,this.running=void 0,this.parentElement=void 0,this.virtualSize=void 0,this.keys=void 0,this.mouse=void 0,this.paused=!1,this.timeScale=1,this.keySet=void 0,this.mouseAction=void 0,this.clicksPerFrame=void 0,this.actionSet=void 0,this.selection=-1,this.firstLoad=!0,this.virtualSize=e,this.ecs=new B,this.virtualCanvas=new A(e),this.entityMap=new me(p.ZERO,e,this.ecs),this.running=!0,this.keySet=new Set,this.keys=new M,this.mouse=new P,this.setSelection=this.setSelection.bind(this),this.getSelection=this.getSelection.bind(this)}return(0,a.Z)(t,[{key:"invalidateSelection",value:function(){this.selection=-1}},{key:"getSelection",value:function(){if(-1===this.selection)return null;var t=this.ecs.getEntity(this.selection,!0);return null==t?null:t}},{key:"setSelection",value:function(t){this.selection=t;for(var e=this.ecs.getEntityIDsWithComponent(x),n=0;n<e.length;n++)this.ecs.removeComponent(e[n],x),this.ecs.hasComponent(e[n],R)&&this.ecs.removeComponent(e[n],S);-1!==t&&(this.ecs.addComponent(t,x),this.ecs.hasComponent(t,R)&&this.ecs.addComponent(t,S))}},{key:"findCanvas",value:function(){this.virtualCanvas.findCanvas()}},{key:"getMousePosition",value:function(){return this.mouse.getMousePosition()}},{key:"getMouseAction",value:function(){return this.mouseAction}},{key:"updateInput",value:function(t){this.mouseAction="none",this.clicksPerFrame=0,this.keySet.clear(),this.mouse.update(),this.keys.update()}},{key:"clearMouse",value:function(){this.mouseAction="none"}},{key:"install",value:function(t){this.virtualCanvas.install(t),this.lastTime=performance.now(),this.parentElement=t,this.firstLoad&&this.firstInit(t)}},{key:"onFirstInit",value:function(){}},{key:"firstInit",value:function(t){var e=this;this.firstLoad=!1,this.initSystems(),this.mouse.install(t,this.virtualCanvas),this.keys.install(),this.mouse.addListener((function(t){t.leftDown&&(e.mouseAction="click",e.clicksPerFrame++)})),this.keys.addListener((function(t){t.down&&e.keySet.add(t.key)}))}},{key:"uninstall",value:function(){this.virtualCanvas.uninstall(),this.keys.uninstall(),this.ecs.clear(),this.parentElement=null}},{key:"addSystems",value:function(){}},{key:"initSystems",value:function(){this.ecs.createSystem(new nt(this.mouse.getMousePosition),-5),this.ecs.createSystem(new it,-5),this.ecs.createSystem(new ut,-5),this.ecs.createSystem(new ot,-5),this.ecs.createSystem(new lt,-5),this.ecs.createSystem(new _,-5),this.ecs.createSystem(new Et,-2),this.ecs.createSystem(new ue,-1),this.ecs.createSystem(new zt,-1),this.ecs.createSystem(new Vt,0),this.ecs.createSystem(new fe,0),this.ecs.createSystem(new ve,0),this.ecs.createSystem(new re,0),this.ecs.createSystem(new qt,0),this.ecs.createSystem(new ht(this.mouse.getMousePosition),0),this.ecs.createSystem(new gt(this.entityMap),0),this.ecs.createSystem(new q),this.ecs.createSystem(new pe),this.ecs.createSystem(new _t(this.virtualCanvas),41),this.ecs.createSystem(new Dt,40),this.ecs.createSystem(new Kt(this.virtualCanvas),49),this.ecs.createSystem(new ce(this.virtualCanvas),50),this.ecs.createSystem(new V(this.virtualCanvas),50),this.ecs.createSystem(new xt(this.virtualCanvas),50),this.ecs.createSystem(new Qt(this.virtualCanvas),54),this.ecs.createSystem(new de(this.virtualCanvas),55),this.ecs.createSystem(new $(this.mouse.getMousePosition,this.virtualCanvas),59),this.ecs.createSystem(new ae(this.virtualCanvas),59),this.ecs.createSystem(new ne(this.virtualCanvas),60),this.ecs.createSystem(new $t(this.virtualCanvas),60),this.addSystems()}},{key:"updateLastTime",value:function(t){this.lastTime=t}},{key:"updateRawTime",value:function(t){var e=t-this.lastTime;this.lastTime=t,this.update(e/1e3)}},{key:"update",value:function(t){this.updateInput(t),this.virtualCanvas.clear(),this.paused?this.ecs.update(0,this):this.ecs.update(t*this.timeScale,this),this.onUpdate(t*this.timeScale)}},{key:"onUpdate",value:function(t){}},{key:"isRunning",value:function(){return this.running}},{key:"preStart",value:function(){}}]),t}();function we(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ze(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ze(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ke=function(){function t(){(0,i.Z)(this,t),this.creators=void 0,this.mutators=void 0,this.renderers=void 0,this.particles=void 0,this.nextParticle=0}return(0,a.Z)(t,[{key:"addEffectManager",value:function(t,e){this.creators.has(t)||this.creators.set(t,e),this.mutators.has(t)||this.mutators.set(t,e),this.renderers.has(t)||this.renderers.set(t,e)}},{key:"addEffect",value:function(t,e,n,r){this.creators.has(t)||this.creators.set(t,e),this.mutators.has(t)||this.mutators.set(t,r),this.renderers.has(t)||this.renderers.set(t,n)}},{key:"createEffect",value:function(t,e,n){this.particles.set(this.nextParticle++,this.creators.get(t).create(e,n))}},{key:"draw",value:function(t,e){var n,r=we(this.particles.keys());try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.particles.get(i);this.renderers.get(a.effect).draw(a,t,e)}}catch(t){r.e(t)}finally{r.f()}}},{key:"update",value:function(t,e){var n,r=we(this.particles.keys());try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.particles.get(i);this.mutators.get(a.effect).update(a,t,e)}}catch(t){r.e(t)}finally{r.f()}}}]),t}();const Re=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{}}},{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}}]),o}(f));var Ce,xe,Se;const Ee=new(C((Se=xe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){var t;return(0,i.Z)(this,o),t=r.call(this),void 0===o.NO_TEXTURE&&(o.NO_TEXTURE=new H("assets/notex.png",p.matching(32))),t}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{source:o.NO_TEXTURE,offset:p.ZERO}}}]),o}(f),xe.NO_TEXTURE=void 0,Ce=Se))||Ce);var be;var Oe,Be=vt(Ee)(be=yt([pt,v])(be=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(t){var e;return(0,i.Z)(this,o),(e=r.call(this)).virtualCanvas=void 0,e.virtualCanvas=t,e}return(0,a.Z)(o,[{key:"updateEntity",value:function(t,e){var n=e.data,r=n.turretBase,i=n.footprint,a=n.position;this.virtualCanvas.drawImage(r.source,W(a.position),p.matching(1.5*i.size))}}]),o}(I))||be)||be,Me=function t(){(0,i.Z)(this,t),this.speed=5,this.damage=5,this.splashRadius=.01};Me.DEFAULT=new Me;const Te=new(C(Oe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{rate:1,elapsed:0,projectile:null,target:null,canFire:!0,barrelOffsets:[p.ZERO],barrel:0,fireStrictness:1,arcReached:!1,projectileType:Me.DEFAULT,tags:[]}}}]),o}(f))||Oe);var Pe;const De=new(C(Pe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{tags:["ground"]}}}]),o}(f))||Pe);var Ae;var Ne,je=vt(Te)(Ae=yt([Xt])(Ae=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){var t;(0,i.Z)(this,o);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=r.call.apply(r,[this].concat(n))).creeps=void 0,t}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("rotationTarget:reached",!0)}},{key:"onEvent",value:function(t,e){e.data.weapon.arcReached=!0}},{key:"systemUpdate",value:function(){this.creeps=this.manager.getEntitiesWithComponent(De)}},{key:"updateEntity",value:function(t,e){var n=e,r=n.data,i=r.weapon,a=r.rotationTarget;!i.canFire&&this.checkInterval(t,i)&&(i.canFire=!0),void 0===i.target&&(i.target=null);for(var o=i.target,s=this.creepInRange(n,o,1),u=0;u<this.creeps.length;u++){var c=this.creeps[u];if(this.isValidCreep(c)){var f=(0,l.intersection)(n.data.weapon.tags,c.data.creep.tags);this.creepInRange(n,c,1)&&f.length>0&&(this.isValidCreep(o)&&s?c.data.pathFollower.point>o.data.pathFollower.point&&(o=this.creeps[u]):o=c)}}i.target=o,null!==o&&o.active&&(a.target=o.data.position.position,i.canFire&&this.creepInRange(n,o)&&i.arcReached&&(i.projectile(n,this.manager),i.canFire=!1,i.barrel=(i.barrel+1)%i.barrelOffsets.length,this.manager.emitEvent("weapon:fire",n)),i.arcReached=!1)}},{key:"creepInRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.isValidCreep(e))return!1;var r=W(t.data.position.position),i=W(e.data.position.position);return Q(r,t.data.range.range+n,i)}},{key:"isValidCreep",value:function(t){return null!=t&&t.active&&void 0!==t.data.creep}}]),o}(I))||Ae)||Ae;const ze=new(C(Ne=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{damage:1}}}]),o}(f))||Ne);var Fe;const Ie=new(C(Fe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{target:null}}}]),o}(f))||Fe);var _e;var Le,We=vt(Ie)(_e=yt([Gt,ze])(_e=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("velocityTarget:reached")}},{key:"onEvent",value:function(t,e){if(e.active){var n=e.data,r=n.damageTarget,i=n.damage;r.target.data.health.health-=i.damage,this.manager.removeEntity(e)}else this.manager.removeEntity(e)}}]),o}(I))||_e)||_e,Ue=n(757),qe=n.n(Ue),He=new(function(){function t(){(0,i.Z)(this,t)}return(0,a.Z)(t,[{key:"gaussian",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,e=0,n=0;n<t;n++)e+=Math.random();return e/t-.5}},{key:"withoutReplacement",value:function(t){for(var e=[],n=1;n<=t;n++)e[n-1]=n;return this.shuffleArray(e),e}},{key:"withoutReplacementGenerator",value:function(t){for(var e=[],n=1;n<=t;n++)e[n-1]=n;return this.shuffleArray(e),qe().mark((function t(){var n;return qe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.length)){t.next=7;break}return t.next=4,e[n];case 4:n++,t.next=1;break;case 7:return t.next=10,0;case 10:t.next=7;break;case 12:case"end":return t.stop()}}),t)}))()}},{key:"shuffleArray",value:function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}}}]),t}());const Ge=new(C(Le=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"defaultData",value:function(){return{radius:1,target:null,tags:["ground"]}}}]),o}(f))||Le);var Xe;var Ve=vt(Ge)(Xe=yt([Gt,ze])(Xe=function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){var t;(0,i.Z)(this,o);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=r.call.apply(r,[this].concat(n))).targets=[],t.fireTex=new H("assets/fire.png"),t}return(0,a.Z)(o,[{key:"onManagerAwake",value:function(){this.listen("velocityTarget:reached")}},{key:"systemUpdate",value:function(){this.targets=this.manager.getEntitiesWithComponent(De)}},{key:"onEvent",value:function(t,e){if(e.active){for(var n=e.data,r=n.splashDamage,i=n.damage,a=0;a<this.targets.length;a++){var o=this.targets[a];o.active&&void 0!==o.data.creep&&(r.target.active&&void 0!==r.target.data.position||Q(W(e.data.position.position),r.radius,W(o.data.position.position))&&(0,l.intersection)(r.tags,o.data.creep.tags).length>0&&(o.data.health.health-=i.damage),Q(W(r.target.data.position.position),r.radius,W(o.data.position.position))&&(0,l.intersection)(r.tags,o.data.creep.tags).length>0&&(o.data.health.health-=i.damage))}this.createExplosion(e.data.position.position,r.radius),this.manager.removeEntity(e)}else this.manager.removeEntity(e)}},{key:"createExplosion",value:function(t,e){var n=this,r=W(t),i=this.manager.createEntity();this.manager.addComponent(i,v,{position:r}),this.manager.addComponent(i,bt,{lifetime:1}),this.manager.addComponent(i,oe,{count:5,rate:.1,producer:function(){var t=n.manager.createEntity(),i=p.fromAngle(720*He.gaussian(),e);n.manager.addComponent(t,v,{position:r}),n.manager.addComponent(t,U,{velocity:i}),n.manager.addComponent(t,y),n.manager.addComponent(t,bt,{lifetime:1}),n.manager.addComponent(t,Pt,{source:n.fireTex,size:p.matching(.25)}),n.manager.addComponent(t,Ot)}})}}]),o}(I))||Xe)||Xe,Ye={name:"Rifle Tower",description:"Short-range tower",size:2,range:4,rotationRate:360,fireRate:1,cost:5,projectile:{speed:50,damage:2,splashRadius:0},levelSprites:["tower-1-1","tower-1-2","tower-1-3"],tags:["ground"],upgrades:[{cost:10,dataDelta:{weapon:{projectileType:{damage:5},rate:.8},sprite:{source:new H("assets/turret-1-2.png")}}},{cost:20,dataDelta:{weapon:{projectileType:{damage:7}},sprite:{source:new H("assets/turret-1-3.png")},range:{range:5}}}],projectileSpawner:"bullet"},$e={name:"MissileTower",description:"Long-range splash tower",size:2,range:8,rotationRate:90,fireRate:1,cost:20,projectile:{speed:20,damage:5,splashRadius:1},levelSprites:["tower-2-1","tower-2-2","tower-2-3"],tags:["ground"],upgrades:[{cost:20,dataDelta:{weapon:{projectileType:{damage:10,splashRadius:1.25}},sprite:{source:new H("assets/turret-2-2.png")}}},{cost:40,dataDelta:{weapon:{projectileType:{damage:10,splashRadius:2}},sprite:{source:new H("assets/turret-2-3.png")}}}],projectileSpawner:"missile"},Ke=new H("assets/turret-3-2.png"),Je=new H("assets/turret-3-3.png"),Qe={name:"Swarmer Tower",description:"Rapidfire Anti-Air Tower",size:2,range:5,rotationRate:270,fireRate:.5,cost:20,projectile:{speed:20,damage:5,splashRadius:.2},barrels:[new p(.2,.1),new p(.2,.1)],levelSprites:["tower-3-1","tower-3-2","tower-3-3"],tags:["air"],upgrades:[{cost:25,dataDelta:{weapon:{rate:.25,range:6},sprite:{source:Ke}}},{cost:50,dataDelta:{weapon:{range:7,projectileType:{damage:10}},sprite:{source:Je},rotationTarget:{turnRate:360}}}],projectileSpawner:"swarmMissile"},tn={name:"Sniper Tower",description:"Long-range slow-firing tower.",size:2,range:12,rotationRate:45,fireRate:3,cost:40,projectile:{speed:40,damage:10,splashRadius:0},levelSprites:["tower-4-1","tower-4-2","tower-4-3"],tags:["air","ground"],upgrades:[{cost:50,dataDelta:{weapon:{projectileType:{damage:15},rate:2.5},rotationTarget:{turnRate:60},range:{range:13},sprite:{source:new H("assets/turret-4-2.png")}}},{cost:100,dataDelta:{weapon:{projectileType:{damage:20,splashRadius:.5}},rotationTarget:{turnRate:90},range:{range:15},sprite:{source:new H("assets/turret-4-3.png")}}}],projectileSpawner:"bullet"};function en(t,e,n,r,i,a){var o=t.createEntity();t.addComponent(o,v,{position:e}),t.addComponent(o,he,{text:n,style:r,size:i,align:a})}function nn(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=t.createEntity();return t.addComponent(a,v,{position:e}),!r&&n?t.addComponent(a,Jt,{delta:n}):(t.addComponent(a,j,{delta:n}),t.addComponent(a,N,{action:i}),t.addComponent(a,Y,{})),a}const rn=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{cost:0,dataDelta:{}}}}]),o}(f));function an(t,e){var n=e.createEntity(),r=p.fromAngle(720*He.gaussian()).scale(He.gaussian()),i=W(t.data.position.position);e.addComponent(n,v,{position:i.add(r)}),e.addComponent(n,U,{velocity:r}),e.addComponent(n,y,{rotation:720*He.gaussian()}),e.addComponent(n,Pt,{size:p.matching(.5),source:new H("assets/Gear.png")}),e.addComponent(n,bt),e.addComponent(n,Ot)}var on=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{name:"Unknown"}}}]),o}(f));var sn=new(function(t){(0,s.Z)(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,a.Z)(o,[{key:"getName",value:function(){return(0,l.lowerFirst)(this.constructor.name)}},{key:"defaultData",value:function(){return{value:0}}}]),o}(f)),un=new H("assets/Bullet.png");function cn(t,e){var n=e.createEntity(),r=e.getEntity(n),i=t.data.weapon.target,a=t.data,o=a.weapon,s=a.range,u=p.ZERO;return u=(u=(u=u.add(t.data.weapon.barrelOffsets[t.data.weapon.barrel])).rotate(W(t.data.rotation.rotation))).add(W(t.data.position.position)),e.addComponent(r,v,{position:u}),e.addComponent(r,y,{rotation:t.data.rotation.rotation}),e.addComponent(r,Xt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position}}),e.addComponent(r,U),e.addComponent(r,Gt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position},velocity:t.data.weapon.projectileType.speed}),e.addComponent(r,Pt,{source:un,rotationOffset:90}),e.addComponent(r,ze,{damage:t.data.weapon.projectileType.damage}),t.data.weapon.projectileType.splashRadius>=.01?e.addComponent(r,Ge,{target:o.target,radius:o.projectileType.splashRadius}):e.addComponent(r,Ie,{target:o.target}),e.addComponent(r,bt,{lifetime:s.range/o.projectileType.speed*1.2}),r}function ln(t,e){var n=p.ZERO;"rotation"in t.data&&(n=p.fromAngle(W(t.data.rotation.rotation))),"velocity"in t.data&&(n=W(t.data.velocity.velocity));var r=n.scale(-1).rotate(30*He.gaussian()).scale(1+He.gaussian()/2);if(!r.equals(p.ZERO)){var i=e.createEntity();return e.addComponent(i,v,{position:t.data.position.position}),e.addComponent(i,y),e.addComponent(i,U,{velocity:r}),e.addComponent(i,bt),e.addComponent(i,Pt,{size:p.matching(.25),source:new H("assets/smoke.png")}),e.addComponent(i,Ot),e.getEntity(i)}}var fn=new H("assets/Missile.png");function hn(t,e){var n=e.createEntity(),r=e.getEntity(n),i=t.data.weapon.target,a=t.data,o=a.weapon,s=a.range,u=p.ZERO;return u=(u=(u=u.add(t.data.weapon.barrelOffsets[t.data.weapon.barrel])).rotate(W(t.data.rotation.rotation))).add(W(t.data.position.position)),e.addComponent(r,v,{position:u}),e.addComponent(r,y,{rotation:t.data.rotation.rotation}),e.addComponent(r,Xt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position}}),e.addComponent(r,U),e.addComponent(r,Gt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position},velocity:t.data.weapon.projectileType.speed}),e.addComponent(r,Pt,{source:fn,rotationOffset:90}),e.addComponent(r,oe,{producer:ln,count:1,rate:.1}),e.addComponent(r,ze,{damage:t.data.weapon.projectileType.damage}),t.data.weapon.projectileType.splashRadius>=.01?e.addComponent(r,Ge,{target:o.target,radius:o.projectileType.splashRadius}):e.addComponent(r,Ie,{target:o.target}),e.addComponent(r,bt,{lifetime:s.range/o.projectileType.speed*1.2}),r}var dn=new H("assets/SwarmMissile.png");function pn(t,e){var n=e.createEntity(),r=e.getEntity(n),i=t.data.weapon.target,a=t.data,o=a.weapon,s=a.range,u=p.ZERO;return u=(u=(u=u.add(t.data.weapon.barrelOffsets[t.data.weapon.barrel])).rotate(W(t.data.rotation.rotation))).add(W(t.data.position.position)),e.addComponent(r,v,{position:u}),e.addComponent(r,y,{rotation:t.data.rotation.rotation}),e.addComponent(r,Xt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position}}),e.addComponent(r,U),e.addComponent(r,Gt,{target:function(){if(!i.active){var t=r.data.position.position;return e.removeEntity(r),t}return i.data.position.position},velocity:t.data.weapon.projectileType.speed}),e.addComponent(r,Pt,{source:dn,rotationOffset:90}),e.addComponent(r,oe,{producer:ln,count:1,rate:.1}),e.addComponent(r,ze,{damage:t.data.weapon.projectileType.damage}),t.data.weapon.projectileType.splashRadius>=.01?e.addComponent(r,Ge,{target:o.target,radius:o.projectileType.splashRadius}):e.addComponent(r,Ie,{target:o.target}),e.addComponent(r,bt,{lifetime:s.range/o.projectileType.speed*1.2}),r}function vn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function mn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yn(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var gn=function(){function t(e,n){(0,i.Z)(this,t),this.model=e,this.ecs=n,this.towerTextures={"tower-1-1":new H("assets/turret-1-1.png"),"tower-1-2":new H("assets/turret-1-2.png"),"tower-1-3":new H("assets/turret-1-3.png"),"tower-2-1":new H("assets/turret-2-1.png"),"tower-2-2":new H("assets/turret-2-2.png"),"tower-2-3":new H("assets/turret-2-3.png"),"tower-3-1":new H("assets/turret-3-1.png"),"tower-3-2":new H("assets/turret-3-2.png"),"tower-3-3":new H("assets/turret-3-3.png"),"tower-4-1":new H("assets/turret-4-1.png"),"tower-4-2":new H("assets/turret-4-2.png"),"tower-4-3":new H("assets/turret-4-3.png")},this.towers=new Map,this.upgrades=new Map,this.projectileSpawners={bullet:cn,missile:hn,swarmMissile:pn},this.baseSprite=new H("assets/turret-base.gif")}return(0,a.Z)(t,[{key:"add",value:function(t,e){this.towers.set(t,e),this.upgrades.set(t,this.combineUpgrades(e))}},{key:"getTower",value:function(t){return this.towers.get(t)}},{key:"createDemoTower",value:function(t,e){var n=this,r=this.towers.get(e),i=this.ecs.createEntity();this.ecs.addComponent(i,v,{position:function(){return n.model.getMousePosition().ceil().addConstant((1-r.size)/2,(1-r.size)/2)}}),this.ecs.addComponent(i,R,{range:r.range}),this.ecs.addComponent(i,y);var a=r.size%2==0?p.matching(-.5):p.ZERO;return this.ecs.addComponent(i,S,{offset:a.addConstant(.5,.5)}),this.ecs.addComponent(i,Pt,{source:this.towerTextures[r.levelSprites[0]],size:p.matching(r.size)}),this.ecs.addComponent(i,sn,{value:r.cost}),this.ecs.addComponent(i,Te,{projectile:cn,rate:r.fireRate,damage:r.projectile.damage,tags:r.tags,elapsed:-1}),i}},{key:"createTower",value:function(t,e){var n=this,r=this.towers.get(e),i=this.ecs.createEntity(),a=this.ecs.getEntity(i);return this.ecs.addComponent(a,v,{position:t}),this.ecs.addComponent(i,v,{position:W(t).ceil().addConstant((1-r.size)/2,(1-r.size)/2)}),this.ecs.addComponent(i,R,{range:r.range}),this.ecs.addComponent(i,y),this.ecs.addComponent(i,Xt,{turnRate:r.rotationRate,strictness:1}),this.ecs.addComponent(i,on,{name:r.name}),this.ecs.addComponent(i,j,{delta:p.matching(r.size/2),offset:p.matching(-.5)}),this.ecs.addComponent(i,N,{action:function(){n.model.setSelection(i)}}),this.ecs.addComponent(i,Pt,{source:this.towerTextures[r.levelSprites[0]],size:p.matching(r.size),rotationOffset:90}),this.ecs.addComponent(i,pt,{source:this.towerTextures[r.levelSprites[0]],size:r.size}),this.ecs.addComponent(i,Ee,{source:this.baseSprite}),this.ecs.addComponent(i,Te,{projectile:this.projectileSpawners[r.projectileSpawner],rate:r.fireRate,damage:r.projectile.damage,barrels:r.barrels||[p.ZERO],tags:r.tags,projectileType:mn({},r.projectile)}),this.ecs.addComponent(i,Re),this.ecs.addComponent(i,sn,{value:Math.floor(.8*r.cost)}),this.ecs.addComponent(i,rn,mn({},(0,l.cloneDeep)(this.upgrades.get(e)))),i}},{key:"combineUpgrades",value:function(t){var e,n={},r=n,i=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return vn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(t.upgrades.slice());try{for(i.s();!(e=i.n()).done;){var a=e.value;Object.assign(r,a),r.dataDelta=mn({},r.dataDelta),r.dataDelta.upgrade=mn({},r.dataDelta.upgrade),r=r.dataDelta.upgrade}}catch(t){i.e(t)}finally{i.f()}return r.cost=0,n}},{key:"canPlace",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.towers.get(e);if(null==r)return!1;if(this.model.money<r.cost)return!1;if(t.x<11||t.x+r.size>40)return!1;if(t.y<1||t.y+r.size>30)return!1;var i=this.checkCollision(t.floor(),r),a=i.collides,o=i.blocked;if(a)return!1;var s=this.model.getPath().findEastWest(o);if(0==s.length)return!1;var u=this.model.getPath().findNorthSouth(o);return 0!=u.length&&(n||(this.model.setEastWestPath(s),this.model.setNorthSouthPath(u),this.ecs.getEntitiesWithComponent(De).forEach((function(t){void 0!==t&&(t.data.pathFollower.invalidated=!0)}))),!0)}},{key:"checkCollision",value:function(t,e){for(var n=Math.floor((e.size-1)/2),r=new p(t.x-n,t.y-n),i=Math.floor(e.size/2),a=new p(t.x+i,t.y+i),o=new Set,s=r.x;s<=a.x;s++)for(var u=r.y;u<=a.y;u++){var c=new p(s,u);if(this.model.getMap().hasEntityAt(c))return o.clear(),{collides:!0,blocked:o};o.add(new p(s,u))}return{collides:!1,blocked:o}}}]),t}(),wn=function(){function t(e){(0,i.Z)(this,t),this.offset=void 0,this.offset=e}return(0,a.Z)(t,null,[{key:"getAllCardinal",value:function(){return void 0===this.cardinal&&(this.cardinal=new Set,this.cardinal.add(this.NORTH),this.cardinal.add(this.EAST),this.cardinal.add(this.SOUTH),this.cardinal.add(this.WEST)),this.cardinal}},{key:"getAllDirections",value:function(){return void 0===this.all&&(this.all=new Set,this.all.add(this.NORTH),this.all.add(this.NORTHEAST),this.all.add(this.EAST),this.all.add(this.SOUTHEAST),this.all.add(this.SOUTH),this.all.add(this.SOUTHWEST),this.all.add(this.WEST),this.all.add(this.NORTHWEST)),this.all}}]),t}();function Zn(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return kn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function kn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}wn.NORTH=new wn(new p(0,-1)),wn.NORTHEAST=new wn(new p(1,-1)),wn.EAST=new wn(new p(1,0)),wn.SOUTHEAST=new wn(new p(1,1)),wn.SOUTH=new wn(new p(0,1)),wn.SOUTHWEST=new wn(new p(-1,1)),wn.WEST=new wn(new p(-1,0)),wn.NORTHWEST=new wn(new p(-1,-1)),wn.all=void 0,wn.cardinal=void 0;var Rn=function t(e,n){(0,i.Z)(this,t),this.parent=void 0,this.position=void 0,this.parent=e,this.position=n},Cn=function(){function t(){(0,i.Z)(this,t)}return(0,a.Z)(t,null,[{key:"findPath",value:function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wn.getAllCardinal(),a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=[new Rn(null,n)],l=new Set,f=new Set;s&&s.forEach((function(t){return f.add(t.toString())})),r.forEach((function(t){return l.add(t.toString())}));var h=new Set;for(h=h.add(n.toString());c.length>0;){var d,p=c.splice(0,1)[0],v=p.position,y=Zn(i);try{for(y.s();!(d=y.n()).done;){var m=d.value,g=v.add(m.offset);if(void 0!==g){if(!(h.has(g.toString())||(h.add(g.toString()),a&&g.x<a.x||g.y<a.y||o&&g.x>o.x||g.y>o.y||e.isBlocked(g)||f.has(g.toString())))){var w=new Rn(p,g);if(l.has(g.toString()))return t.fromPath(w,u);h=h.add(g.toString()),c.push(w)}}else console.error("Something went wrong:"),console.error(JSON.stringify(p)),console.error(JSON.stringify(m)),console.error(c)}}catch(t){y.e(t)}finally{y.f()}}return[]}},{key:"fromPath",value:function(t,e){for(var n=t,r=[];null!=n;)r=[n.position].concat((0,m.Z)(r)),n=n.parent;if(e){for(var i=[r[0]],a=1;a<r.length-1;a++){var o=i[i.length-1],s=r[a],u=r[a+1],c=s.subtract(o).normalize(),l=u.subtract(s).normalize();c.equals(l)||(i.push(s),a++)}return i.push(r[r.length-1]),i}return r}}]),t}(),xn=function(){function t(e){(0,i.Z)(this,t),this.model=e,this.southEnd=new Set,this.eastEnd=new Set,this.southEnd.add(new p(19,30)),this.southEnd.add(new p(20,30)),this.southEnd.add(new p(21,30)),this.southEnd.add(new p(22,30)),this.southEnd.add(new p(23,30)),this.eastEnd.add(new p(39,13)),this.eastEnd.add(new p(39,14)),this.eastEnd.add(new p(39,15)),this.eastEnd.add(new p(39,16)),this.eastEnd.add(new p(39,17))}return(0,a.Z)(t,[{key:"findEastWest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Cn.findPath(this.model.getMap(),new p(10,15),this.eastEnd,wn.getAllCardinal(),new p(10,0),this.model.getVirtualSize(),t,e);return n}},{key:"findNorthSouth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Cn.findPath(this.model.getMap(),new p(25,0),this.southEnd,wn.getAllCardinal(),new p(10,0),this.model.getVirtualSize(),t,e);return n}}]),t}();function Sn(t,e,n){return function(r,i){var a=W(r.data.position.position),o=i.createEntity(),s=W(n);i.addComponent(o,v,{position:a}),i.addComponent(o,U,{velocity:new p(0,0)}),i.addComponent(o,y),i.addComponent(o,Gt,{velocity:5+1.2*s}),i.addComponent(o,Xt,{turnRate:720}),i.addComponent(o,Ht,{path:t}),i.addComponent(o,j,{delta:p.matching(.5),offset:p.matching(-.5)}),i.addComponent(o,N,{action:function(t){return e.setSelection(t.id)}}),i.addComponent(o,X,{source:new H("assets/Fast.png"),frames:[.1,.1,.1,.1,.1,.1],size:p.matching(2),frameSize:new p(64,64)}),i.addComponent(o,Rt,{health:Math.floor(8*s),maxHealth:Math.floor(8*s)}),i.addComponent(o,Zt),i.addComponent(o,De,{tags:["ground"]}),i.addComponent(o,on,{name:"Normal Creep"})}}function En(t,e,n){return function(r,i){var a=W(r.data.position.position),o=i.createEntity(),s=W(n);i.addComponent(o,v,{position:a}),i.addComponent(o,U,{velocity:new p(0,0)}),i.addComponent(o,y),i.addComponent(o,Gt,{velocity:4+.8*s}),i.addComponent(o,Xt),i.addComponent(o,Ht,{path:t}),i.addComponent(o,j,{delta:p.matching(.5),offset:p.matching(-.5)}),i.addComponent(o,N,{action:function(t){return e.setSelection(t.id)}}),i.addComponent(o,X,{source:new H("assets/Flying.png"),frames:[.1,.1,.1],size:p.matching(3),frameSize:new p(64,64)}),i.addComponent(o,Rt,{health:Math.floor(.8*s*10),maxHealth:Math.floor(.8*s*10)}),i.addComponent(o,Zt),i.addComponent(o,De,{tags:["air"]}),i.addComponent(o,on,{name:"Flying Creep"})}}function bn(t,e,n){return function(r,i){var a=W(r.data.position.position),o=i.createEntity(),s=W(n);i.addComponent(o,v,{position:a}),i.addComponent(o,U,{velocity:new p(0,0)}),i.addComponent(o,y),i.addComponent(o,Gt,{velocity:3+s}),i.addComponent(o,Xt,{turnRate:360}),i.addComponent(o,Ht,{path:t}),i.addComponent(o,j,{delta:p.matching(.5),offset:p.matching(-.5)}),i.addComponent(o,N,{action:function(t){return e.setSelection(t.id)}}),i.addComponent(o,X,{source:new H("assets/Normal.png"),frames:[.1,.1,.1,.1,.1,.1],size:p.matching(2),frameSize:p.matching(64)}),i.addComponent(o,Rt,{health:Math.floor(10*s),maxHealth:Math.floor(10*s)}),i.addComponent(o,Zt),i.addComponent(o,De,{tags:["ground"]}),i.addComponent(o,on,{name:"Normal Creep"})}}var On=function(){function t(e){var n=this;(0,i.Z)(this,t),this.model=e,this.northNormalCreepGenerator=void 0,this.eastNormalCreepGenerator=void 0,this.northNormalPlusCreepGenerator=void 0,this.eastNormalPlusCreepGenerator=void 0,this.northFastCreepGenerator=void 0,this.eastFastCreepGenerator=void 0,this.northFlyingCreepGenerator=void 0,this.eastFlyingCreepGenerator=void 0,this.statModifier=1,this.wave=0,this.getStatModifier=void 0,this.getStatModifier=this._getStatModifier.bind(this),this.northNormalCreepGenerator=bn(e.getNorthSouthPath,e,this.getStatModifier),this.eastNormalCreepGenerator=bn(e.getEastWestPath,e,this.getStatModifier),this.eastNormalPlusCreepGenerator=bn(e.getEastWestPath,e,(function(){return 1.5*n.getStatModifier()})),this.northNormalPlusCreepGenerator=bn(e.getNorthSouthPath,e,(function(){return 1.5*n.getStatModifier()})),this.northFastCreepGenerator=Sn(e.getNorthSouthPath,e,this.getStatModifier),this.eastFastCreepGenerator=Sn(e.getEastWestPath,e,this.getStatModifier),this.northFlyingCreepGenerator=En([new p(25,0),new p(25,30)],e,this.getStatModifier),this.eastFlyingCreepGenerator=En([new p(10,15),new p(40,15)],e,this.getStatModifier)}return(0,a.Z)(t,[{key:"nextWave",value:function(){this.wave++,this.statModifier=1+.1*this.wave}},{key:"getNorthWave",value:function(){var t=this.wave%5,e=20+10*Math.floor(this.wave/10);if(this.isNorthWave())switch(t){case 0:case 1:return{count:e,entity:this.northNormalCreepGenerator};case 2:return{count:e,entity:this.northFastCreepGenerator};case 3:return{count:e,entity:this.northNormalPlusCreepGenerator};case 4:return{count:e,entity:this.northFlyingCreepGenerator}}return{count:0,entity:this.northNormalCreepGenerator}}},{key:"getEastWave",value:function(){var t=this.wave%5,e=20+10*Math.floor(this.wave/10);if(this.isEastWave())switch(t){case 0:case 1:return{count:e,entity:this.eastNormalCreepGenerator};case 2:return{count:e,entity:this.eastFastCreepGenerator};case 3:return{count:e,entity:this.eastNormalPlusCreepGenerator};case 4:return{count:e,entity:this.eastFlyingCreepGenerator}}return{count:0,entity:this.eastNormalCreepGenerator}}},{key:"isNorthWave",value:function(){return this.wave%3!=0}},{key:"isEastWave",value:function(){return this.wave%3!=1}},{key:"_getStatModifier",value:function(){return this.statModifier}},{key:"nextNorth",value:function(){return(this.wave+1)%3!=0}},{key:"nextEast",value:function(){return(this.wave+1)%3!=1}}]),t}(),Bn=n(978),Mn=function(){function t(e,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){};(0,i.Z)(this,t),this.el=void 0,this.ready=!1,this.continue=!1,this.loop=!1,this.start=0,this.end=0,this._playing=!1,this.cutoff=0,this.currentCutoffTimeout=void 0,this.currentLoopTimeout=void 0,this.currentDurationTimeout=void 0,this.el=new Audio(e),this.el.addEventListener("load",function(){r.ready=!0,r.end=Math.min(n,r.el.duration),s(r.getDuration())}.bind(this)),n&&(this.cutoff=n),this.start=o,this.loop=a}return(0,a.Z)(t,[{key:"getDuration",value:function(){return this.end-this.start}},{key:"play",value:function(){var t=this;this.el.play(),this.continue=!0,this.el.currentTime=this.start,this._playing=!0,this.loop?this.currentLoopTimeout=setTimeout((function(){t.continue&&(t.el.currentTime=t.start,t.playRec())}),1e3*this.cutoff):this.cutoff>0?(clearTimeout(this.currentCutoffTimeout),this.currentCutoffTimeout=setTimeout((function(){t.stop()}),1e3*this.cutoff)):(clearTimeout(this.currentDurationTimeout),this.currentDurationTimeout=setTimeout((function(){return t._playing=!1}),1e3*this.el.duration))}},{key:"playRec",value:function(){var t=this;this.currentLoopTimeout=setTimeout((function(){t.continue&&(t.el.currentTime=0,t.playRec())}),1e3*this.cutoff)}},{key:"stop",value:function(){this.el.pause(),this.continue=!1,this._playing=!1,this.el.currentTime=0}},{key:"playing",get:function(){return this._playing}}]),t}();function Tn(){return Bn.n.getData().audio}var Pn=function(){function t(e,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,i.Z)(this,t),this.pool=void 0,this.ids=void 0,this.duration=void 0;var s=new Mn(n,o,!1,a,(function(t){r.duration=t}));this.pool=[s],this.ids=[];for(var u=1;u<e;u++)this.pool.push(new Mn(n,o,!1,a)),this.ids.push(u)}return(0,a.Z)(t,[{key:"play",value:function(){var t=this,e=this.ids.splice(1,1)[0];void 0!==e&&(this.pool[e].play(),setTimeout((function(){t.ids.push(e)}),this.duration))}}]),t}();function Dn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var An=function(t){(0,s.Z)(h,t);var e,n,f=(e=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function h(){var t;return(0,i.Z)(this,h),(t=f.call(this,new p(40,30))).particleManager=void 0,t.unstructured=void 0,t.lives=20,t.money=30,t.wave=void 0,t.waveSet=void 0,t.persistence=void 0,t._actionMap=void 0,t.eastWestPath=[],t.northSouthPath=void 0,t.actionQueue=void 0,t.mouseEntity=null,t.towerManager=void 0,t.pathChecker=void 0,t.floorTile=new H("assets/FloorTile.png"),t.creepManager=void 0,t.activeTower=null,t.northSpawnerID=-1,t.eastSpawnerID=-1,t.score=0,t.arrow=new H("assets/Arrow.png"),t.getEastWestPath=void 0,t.getNorthSouthPath=void 0,t.first=!0,t.audioLoop=new Mn("assets/loop.mp3",147,!0),t.turretFireSound=new Pn(10,"assets/gun.mp3",.6,2),t.sellSound=new Pn(5,"assets/sell.mp3",0,3),t.creepDeathSound=new Pn(5,"assets/crunch.mp3",0,1),t.creepEscapeSound=new Pn(3,"assets/escape.mp3",0,1),t.buildSound=new Mn("assets/construction.mp3",2),t._actionMap=new Z,t.initActions(),t.towerManager=new gn((0,o.Z)(t),t.ecs),t.pathChecker=new xn((0,o.Z)(t)),t.getEastWestPath=t._getEastWestPath.bind((0,o.Z)(t)),t.getNorthSouthPath=t._getNorthSouthPath.bind((0,o.Z)(t)),t.creepManager=new On((0,o.Z)(t)),t.particleManager=new ke,t.initParticleEffects(),t.mouse.addListener(t.handleClick.bind((0,o.Z)(t))),t.towerManager.add("tower-1",Ye),t.towerManager.add("tower-2",$e),t.towerManager.add("tower-3",Qe),t.towerManager.add("tower-4",tn),t.ecs.listenEvent("weapon:fire",(function(e){Tn()&&t.turretFireSound.play()})),t.ecs.listenEvent("sellable:sell",(function(e){var n=e.extra.position,r=t.ecs.createEntity();t.ecs.addComponent(r,v,{position:n.position}),t.ecs.addComponent(r,oe,{producer:an,rate:10,elapsed:10,count:30}),t.ecs.addComponent(r,bt,{lifetime:1.5}),Tn()&&t.sellSound.play()})),t.ecs.listenEvent("pathFollower:done",(function(e){t.lives--,t.ecs.removeEntity(e.entity),Tn()&&t.creepEscapeSound.play(),t.lives<=0&&(t.running=!1,t.entityMap.clear(),t.audioLoop.stop(),t.ecs.clear(),Bn.n.router.requestTransition("scores",!1,{score:t.score}))})),t.ecs.listenEvent("health:die",(function(e){var n=e.extra.position;t.money+=5,t.score+=5;var r=t.ecs.createEntity();t.ecs.addComponent(r,v,{position:n.position}),t.ecs.addComponent(r,U,{velocity:new p(0,-.5)}),t.ecs.addComponent(r,he,{text:"+5",style:"#ffffff"}),t.ecs.addComponent(r,oe,{producer:an,rate:10,elapsed:10,count:30}),t.ecs.addComponent(r,bt,{lifetime:1.5}),Tn()&&t.creepDeathSound.play()})),t}return(0,a.Z)(h,[{key:"sendWave",value:function(){var t=this.ecs.getEntity(this.northSpawnerID),e=this.ecs.getEntity(this.eastSpawnerID),n=t.data,r=n.spawner,i=n.sprite,a=e.data,o=a.spawner,s=a.sprite;if(!(r.total<r.limit||o.total<o.limit)){var u=this.creepManager.getEastWave(),c=u.count,l=u.entity;o.producer=l,o.rate=1/this.creepManager.getStatModifier(),o.total=0,o.limit=c,this.creepManager.nextEast()?s.size=p.ONES:s.size=p.ZERO;var f=this.creepManager.getNorthWave(),h=f.count,d=f.entity;r.producer=d,r.rate=1/this.creepManager.getStatModifier(),r.total=0,r.limit=h,this.creepManager.nextNorth()?i.size=p.ONES:i.size=p.ZERO,this.creepManager.nextWave()}}},{key:"initActions",value:function(){this._actionMap.createAction("upgrade",!0),this._actionMap.createAction("sell",!0),this._actionMap.createAction("wave",!0),this._actionMap.createAction("clear"),this._actionMap.createAction("setTower"),this._actionMap.createAction("exit")}},{key:"initParticleEffects",value:function(){this.particleManager.addEffectManager}},{key:"createSpawner",value:function(t,e){var n=this.ecs.createEntity();return this.ecs.addComponent(n,v,{position:t}),this.ecs.addComponent(n,oe,{limit:0,rate:1,count:1}),this.ecs.addComponent(n,y),this.ecs.addComponent(n,Pt,{source:this.arrow,size:e?p.ONES:p.ZERO,rotationOffset:e?0:90}),n}},{key:"preStart",value:function(){var t=this,e=Bn.n.persistence.get(this).keyMap;this._actionMap.clearListeners(),this.keys.clearListeners();for(var n=function(){var n=i[r];t.keys.addKeyListener(e[n],(function(e){e.down&&t._actionMap.invoke(n)}))},r=0,i=Object.keys(e);r<i.length;r++)n();this.keys.addKeyListener("escape",(function(){t._actionMap.invoke("clear")})),this.keys.addKeyListener("]",(function(e){e.down&&(t.paused=!t.paused)})),this.timeScale=1,this.keys.addKeyListener("[",(function(e){e.down&&(t.timeScale<2?t.timeScale=2:t.timeScale=1)})),this._actionMap.addHandler("sell",this.attemptSell.bind(this)),this._actionMap.addHandler("wave",this.sendWave.bind(this)),this._actionMap.addHandler("upgrade",this.attemptUpgrade.bind(this)),this._actionMap.addHandler("clear",this.clearMouseMode.bind(this)),this._actionMap.addHandler("setTower",this.setMouseMode.bind(this)),this._actionMap.addHandler("exit",(function(){t.running=!1,t.entityMap.clear(),t.audioLoop.stop(),t.ecs.clear(),Bn.n.router.requestTransition("home")})),this.entityMap.clear(),this.running=!0,this.ecs.clear(),this.money=30,this.lives=20,this.score=0,Tn()&&this.audioLoop.play(),this.first=!1,function(t,e){nn(t,new p(5,15),new p(5,15)),en(t,new p(5,1),"Tower Defense","#ffffff",2),en(t,new p(2.5,2),(function(){return"Lives: "+e.lives.toFixed(0)}),"#ffffff"),en(t,new p(7.5,2),(function(){return"Money: "+e.money.toFixed(0)}),"#ffffff"),en(t,new p(5,4),"Towers","#ffffff");var n=nn(t,new p(2,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-1"})}));t.addComponent(n,he,{text:"1",style:"#ffffff"});var r=nn(t,new p(4,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-2"})}));t.addComponent(r,he,{text:"2",style:"#ffffff"});var i=nn(t,new p(6,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-3"})}));t.addComponent(i,he,{text:"3",style:"#ffffff"});var a=nn(t,new p(8,5),new p(.5,.5),!0,(function(){return e.actionMap.invoke("setTower",{tower:"tower-4"})}));t.addComponent(a,he,{text:"4",style:"#ffffff"}),en(t,new p(5,7),"Selected","#ffffff"),en(t,new p(1,8),(function(){var t=e.getSelection();if(null!==t){var n="";if("name"in t.data&&(n+=t.data.name.name+"\n"),"health"in t.data&&(n+="Health: "+t.data.health.health.toFixed(0)+"\n"),"value"in t.data&&(n+="Value: "+t.data.value.value.toFixed(0)+"\n"),"weapon"in t.data){var r=t.data.weapon;n+="Ready to Fire: "+r.canFire+"\n",n+="Fire Rate: "+(1/r.rate).toFixed(2)+" per second\n",n+="Damage: "+r.projectileType.damage.toFixed(2)+"\n",n+="Can Target: "+r.tags.join(", ")+"\n"}return"upgrade"in t.data&&t.data.upgrade.cost>0&&(n+="Upgrade cost: "+t.data.upgrade.cost.toFixed(0)+"\n"),n}return""}),"#ffffff",1,"left");var o=nn(t,new p(2.675,24),new p(2.125,1),!0,(function(){return e.actionMap.invoke("sell")}));t.addComponent(o,he,{text:"Sell",style:"#ffffff"});var s=nn(t,new p(7.375,24),new p(2.125,1),!0,(function(){return e.actionMap.invoke("upgrade")}));t.addComponent(s,he,{text:"Upgrade",style:"#ffffff"});var u=nn(t,new p(5,26.5),new p(4.5,1),!0,(function(){return e.actionMap.invoke("wave")}));t.addComponent(u,he,{text:"Send Next Wave",style:"#ffffff"});var c=nn(t,new p(5,29),new p(4.5,1),!0,(function(){return e.actionMap.invoke("exit")}));t.addComponent(c,he,{text:"Exit",style:"#ffffff"})}(this.ecs,this),this.northSouthPath=this.getPath().findNorthSouth(new Set),this.eastWestPath=this.getPath().findEastWest(new Set),this.northSpawnerID=this.createSpawner(new p(25,0),!1),this.eastSpawnerID=this.createSpawner(new p(10,15),!0);for(var a=0;a<30;a++)for(var o=10;o<40;o++){var s=this.ecs.createEntity();this.ecs.addComponent(s,v,{position:new p(o,a)}),this.ecs.addComponent(s,y),this.ecs.addComponent(s,Ft,{source:this.floorTile})}for(var u=10;u<40;u++)u>=23&&u<=27||(this.createBlocker(new p(u,0)),this.createBlocker(new p(u,29)));for(var c=1;c<29;c++)c>=13&&c<=17||(this.createBlocker(new p(10,c)),this.createBlocker(new p(39,c)))}},{key:"addSystems",value:function(){this.ecs.createSystem(new je,-1),this.ecs.createSystem(new Be(this.virtualCanvas),47),this.ecs.createSystem(new We),this.ecs.createSystem(new Ve)}},{key:"handleClick",value:function(t){null!==this.activeTower&&t.leftDown&&this.buildTower(t.coordinate,this.activeTower)}},{key:"clearMouseMode",value:function(){null!==this.mouseEntity&&(this.setSelection(-1),this.ecs.removeEntity(this.mouseEntity.id),this.mouseEntity=null,this.activeTower=null)}},{key:"setMouseMode",value:function(t,e){var n=e.tower;this.activeTower=n,null!==this.mouseEntity&&this.clearMouseMode();var r=this.towerManager.createDemoTower(this.getMousePosition,n);this.mouseEntity=this.ecs.getEntity(r),this.setSelection(r)}},{key:"attemptSell",value:function(){var t=this.getSelection();if(null!==t&&this.ecs.hasComponent(t.id,Re)){var e=t.data.value.value;this.ecs.emitEvent("sellable:sell",t,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Dn(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.data)),this.money+=W(e),this.ecs.removeEntity(t.id),this.invalidateSelection()}}},{key:"attemptUpgrade",value:function(){var t=this.getSelection();if(null!==t&&this.ecs.hasComponent(t,rn)){var e=t,n=W(t.data.upgrade.cost);n>this.money||(this.money-=n,e.data=(0,l.merge)(e.data,t.data.upgrade.dataDelta))}}},{key:"buildTower",value:function(t,e){this.towerManager.canPlace(W(t),e)&&(this.towerManager.createTower(W(t),e),this.money-=this.towerManager.getTower(e).cost,Tn()&&this.buildSound.play())}},{key:"createBlocker",value:function(t){var e=this.ecs.createEntity();this.ecs.addComponent(e,v,{position:t.floor()}),this.ecs.addComponent(e,y),this.ecs.addComponent(e,Pt,{source:new H("assets/blocker.png")}),this.ecs.addComponent(e,pt,{size:1})}},{key:"actionMap",get:function(){return this._actionMap.asImmutable()}},{key:"getMap",value:function(){return this.entityMap}},{key:"getVirtualSize",value:function(){return this.virtualSize}},{key:"setNorthSouthPath",value:function(t){this.northSouthPath=t}},{key:"setEastWestPath",value:function(t){this.eastWestPath=t}},{key:"_getEastWestPath",value:function(){return this.eastWestPath}},{key:"_getNorthSouthPath",value:function(){return this.northSouthPath}},{key:"getPath",value:function(){return this.pathChecker}}]),h}(ge)}}]);
//# sourceMappingURL=440.js.map